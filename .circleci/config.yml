# auto generated file. Edit config.base.yaml if you want to change
version: 2.1
orbs:
  win: circleci/windows@2.2.0
machine:
  environment:
    PATH: '${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin'
nix_defaults: &nix_defaults
  working_directory: ~/repo
  docker:
    - image: 'circleci/node:10.18'
  resource_class: large
win_defaults: &win_defaults
  working_directory: C:\home\circleci\repo
  executor:
    name: win/default
    shell: cmd.exe
mac_defaults: &mac_defaults
  macos:
    xcode: 11.3.0
jobs:
  linux_install_script_sanity_check:
    <<: *nix_defaults
    steps:
      - checkout
      - run: cat install | bash
      - run: echo "export PATH=$PATH:$HOME/.amplify/bin" >> $BASH_ENV
      - run: amplify version
  windows_install_script_sanity_check:
    <<: *win_defaults
    steps:
      - checkout
      - run: copy install-win install-win.cmd
      - run: install-win.cmd
      - run: "%userprofile%\\.amplify\\bin\\amplify version"
  mac_install_script_sanity_check:
    <<: *mac_defaults
    steps:
      - checkout
      - run: cat install | bash
      - run: echo "export PATH=$PATH:$HOME/.amplify/bin" >> $BASH_ENV
      - run: amplify version
  promote_install_script_to_prod:
    <<: *nix_defaults
    steps:
      - checkout
      - run: git push -f origin install-script-dev:install-script-prod
workflows:
  version: 2
  install_script_workflow:
    jobs:
      - linux_install_script_sanity_check
      - windows_install_script_sanity_check
      - mac_install_script_sanity_check
      - promote_install_script_to_prod:
          requires:
            - linux_install_script_sanity_check
            - windows_install_script_sanity_check
            - mac_install_script_sanity_check
          filters:
            branches:
              only:
                - install-script-dev
