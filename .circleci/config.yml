# auto generated file. Edit config.base.yaml if you want to change
version: 2.1
orbs:
  aws-ecr: circleci/aws-ecr@6.15.3
machine:
  environment:
    PATH: ${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin
executors:
  windows:
    machine:
      image: windows-server-2019-vs2019:stable
      resource_class: windows.large
      shell: bash.exe
    working_directory: ~/repo
    environment:
      AMPLIFY_DIR: C:/home/circleci/repo/out
      AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
  linux:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
defaults:
  working_directory: ~/repo
  parameters:
    os:
      type: executor
      default: linux
  executor: << parameters.os >>
clean_e2e_resources:
  name: Cleanup resources
  command: |
    pwd
    cd packages/amplify-e2e-tests
    yarn clean-e2e-resources job ${CIRCLE_BUILD_NUM}
  working_directory: ~/repo
scan_e2e_test_artifacts:
  name: Scan And Cleanup E2E Test Artifacts
  command: |
    if ! yarn ts-node .circleci/scan_artifacts.ts; then
      echo "Cleaning the repository"
      git clean -fdx
      exit 1
    fi
  when: always
install_cli_from_local_registery:
  name: Start verdaccio, install node CLI and amplify-app
  command: |
    source .circleci/local_publish_helpers.sh
    startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
    setNpmRegistryUrlToLocal
    changeNpmGlobalPath
    npm install -g @aws-amplify/cli
    npm install -g amplify-app
    unsetNpmRegistryUrl
jobs:
  build:
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - checkout
      - run: yarn run production-build
      - save_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
          paths:
            - ~/.cache
      - save_cache:
          key: amplify-cli-ssh-deps-{{ .Branch }}
          paths:
            - ~/.ssh
      - when:
          condition:
            equal:
              - docker:
                  - image: >-
                      public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
                working_directory: ~/repo
                resource_class: large
                environment:
                  AMPLIFY_DIR: /home/circleci/repo/out
                  AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
              - << parameters.os >>
          steps:
            - persist_to_workspace:
                root: .
                paths: .
  test:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Install Java
          command: sudo apt-get update && sudo apt-get install default-jdk
      - run:
          name: Lint
          command: yarn lint
      - run:
          name: Run tests
          command: yarn test-ci
      - run:
          name: Collect code coverage
          command: yarn coverage
  mock_e2e_tests:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Install Java
          command: sudo apt-get update && sudo apt-get install default-jdk
      - run:
          name: Run Transformer end-to-end tests with mock server
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/amplify-util-mock/
            yarn e2e
          no_output_timeout: 90m
          environment:
            JEST_JUNIT_OUTPUT: reports/junit/js-test-results.xml
      - store_test_results:
          path: packages/amplify-util-mock/
  publish_to_local_registry:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Publish to verdaccio
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            loginToLocalRegistry
            git config user.email not@used.com
            git config user.name "Doesnt Matter"
            yarn publish-to-verdaccio
            unsetNpmRegistryUrl
      - run:
          name: Generate unified changelog
          command: |
            git reset --hard HEAD
            yarn update-versions
            yarn ts-node scripts/unified-changelog.ts
      - run:
          name: Save new amplify GitHub tag
          command: node scripts/echo-current-cli-version.js > .amplify-pkg-version
      - save_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/verdaccio-cache/
      - save_cache:
          key: amplify-unified-changelog-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/UNIFIED_CHANGELOG.md
      - save_cache:
          key: amplfiy-pkg-tag-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/.amplify-pkg-version
  build_pkg_binaries:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio and package CLI
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            yarn pkg-all
            unsetNpmRegistryUrl
      - save_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/out
  graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
  amplify_sudo_install_test:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Update OS Packages
          command: sudo apt-get update
      - run:
          name: Start verdaccio and Install Amplify CLI as sudo
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setSudoNpmRegistryUrlToLocal
            changeSudoNpmGlobalPath
            sudo npm install -g @aws-amplify/cli
            unsetSudoNpmRegistryUrl
            amplify version
  amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
  amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
  amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  amplify_migration_tests_non_multi_env_layers:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run tests migrating from CLI v4.28.2
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v4.28.2_nonmultienv_layers --maxWorkers=3
            $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  amplify_migration_tests_multi_env_layers:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.52.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v4.52.0_multienv_layers --maxWorkers=3
            $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  amplify_migration_tests_v4_30_0:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Update OS Packages
          command: sudo apt-get update
      - run:
          name: Run tests migrating from CLI v4.30.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.30.0_auth --maxWorkers=3
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  amplify_migration_tests_latest:
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  amplify_console_integration_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          command: |
            echo "export PATH=~/.npm-global/bin:$PATH" >> $BASH_ENV
            source $BASH_ENV
            source .circleci/local_publish_helpers.sh
            amplify -v
            cd packages/amplify-console-integration-tests
            retry yarn run console-integration --maxWorkers=3
          name: Run Amplify Console integration tests
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-console-integration-tests/
      - store_artifacts:
          path: >-
            ~/repo/packages/amplify-console-integration-tests/console-integration-reports
  integration_test:
    working_directory: ~/repo
    resource_class: large
    docker:
      - image: cypress/base:12
        environment:
          TERM: dumb
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Setup Dependencies
          command: |
            apt-get update
            apt-get install -y sudo
            sudo apt-get install -y tcl
            sudo apt-get install -y expect
            sudo apt-get install -y zip
            sudo apt-get install -y lsof
            sudo apt-get install -y python python-pip libpython-dev
            sudo apt-get install -y jq
            pip install awscli
      - run: cd .circleci/ && chmod +x aws.sh
      - run: expect .circleci/aws_configure.exp
      - run:
          name: Configure Amplify CLI
          command: >
            yarn rm-dev-link && yarn link-dev && yarn rm-aa-dev-link && yarn
            link-aa-dev

            echo 'export PATH="$(yarn global bin):$PATH"' >> $BASH_ENV

            amplify-dev
      - run:
          name: Clone auth test package
          command: |
            cd ..
            git clone $AUTH_CLONE_URL
            cd aws-amplify-cypress-auth
            yarn --cache-folder ~/.cache/yarn
      - run: cd .circleci/ && chmod +x auth.sh
      - run: cd .circleci/ && chmod +x amplify_init.sh
      - run: cd .circleci/ && chmod +x amplify_init.exp
      - run: expect .circleci/amplify_init.exp ../aws-amplify-cypress-auth
      - run: expect .circleci/enable_auth.exp
      - run: cd ../aws-amplify-cypress-auth
      - run: yarn --frozen-lockfile --cache-folder ~/.cache/yarn
      - run: >-
          cd ../aws-amplify-cypress-auth/src && cat $(find . -type f -name
          'aws-exports*')
      - run:
          name: Start Auth test server in background
          command: |
            cd ../aws-amplify-cypress-auth
            pwd
            yarn start
          background: true
      - run: cat $(find ../repo -type f -name 'auth_spec*')
      - run:
          name: Run cypress tests for auth
          command: |
            cd ../aws-amplify-cypress-auth
            yarn add cypress@6.8.0 --save
            cp ../repo/cypress.json .
            cp -R ../repo/cypress .
            yarn cypress run --spec $(find . -type f -name 'auth_spec*')
      - run: sudo kill -9 $(lsof -t -i:3000)
      - run: cd .circleci/ && chmod +x delete_auth.sh
      - run: expect .circleci/delete_auth.exp
      - run:
          name: Clone API test package
          command: |
            cd ..
            git clone $API_CLONE_URL
            cd aws-amplify-cypress-api
            yarn --cache-folder ~/.cache/yarn
      - run: cd .circleci/ && chmod +x api.sh
      - run: expect .circleci/amplify_init.exp ../aws-amplify-cypress-api
      - run: expect .circleci/enable_api.exp
      - run: cd ../aws-amplify-cypress-api
      - run: yarn --frozen-lockfile --cache-folder ~/.cache/yarn
      - run: >-
          cd ../aws-amplify-cypress-api/src && cat $(find . -type f -name
          'aws-exports*')
      - run:
          name: Start API test server in background
          command: |
            cd ../aws-amplify-cypress-api
            pwd
            yarn start
          background: true
      - run:
          name: Run cypress tests for api
          command: |
            cd ../aws-amplify-cypress-api
            yarn add cypress@6.8.0 --save
            cp ../repo/cypress.json .
            cp -R ../repo/cypress .
            yarn cypress run --spec $(find . -type f -name 'api_spec*')
      - run: cd .circleci/ && chmod +x delete_api.sh
      - run: expect .circleci/delete_api.exp
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_artifacts:
          path: /root/aws-amplify-cypress-auth/cypress/videos
      - store_artifacts:
          path: /root/aws-amplify-cypress-auth/cypress/screenshots
      - store_artifacts:
          path: /root/aws-amplify-cypress-api/cypress/videos
      - store_artifacts:
          path: /root/aws-amplify-cypress-api/cypress/screenshots
  deploy:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          keys:
            - amplify-cli-ssh-deps-{{ .Branch }}
      - run:
          name: Authenticate with npm
          command: echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > ~/.npmrc
      - run:
          name: Publish Amplify CLI
          command: |
            bash ./.circleci/publish.sh
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
  github_prerelease:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: amplify-unified-changelog-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplfiy-pkg-tag-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Compress binaries
          command: |
            cd out
            tar zcvf amplify-pkg-macos.tgz amplify-pkg-macos
            tar zcvf amplify-pkg-linux.tgz amplify-pkg-linux
            tar zcvf amplify-pkg-win.exe.tgz amplify-pkg-win.exe
      - run:
          name: Publish Amplify CLI GitHub prerelease
          command: |
            version=$(cat .amplify-pkg-version)
            yarn ts-node scripts/github-prerelease.ts $version
  github_prerelease_install_sanity_check:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - restore_cache:
          key: amplfiy-pkg-tag-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Install packaged Amplify CLI
          command: >
            version=$(cat .amplify-pkg-version)

            curl -sL https://aws-amplify.github.io/amplify-cli/install |
            version=v$version bash

            echo "export PATH=$PATH:$HOME/.amplify/bin" >> $BASH_ENV
      - run:
          name: Sanity check install
          command: |
            amplify version
  github_release:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplfiy-pkg-tag-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Publish Amplify CLI GitHub release
          command: |
            version=$(cat .amplify-pkg-version)
            yarn ts-node scripts/github-release.ts $version
  cleanup_resources:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run cleanup script
          command: |
            cd packages/amplify-e2e-tests
            yarn clean-e2e-resources
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
  cleanup_resources_after_e2e_runs:
    docker:
      - image: public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run cleanup script
          command: |
            cd packages/amplify-e2e-tests
            yarn clean-e2e-resources workflow ${CIRCLE_WORKFLOW_ID}
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
  api_4-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/api_4.test.ts
      CLI_REGION: us-east-2
  auth_6-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/auth_6.test.ts
      CLI_REGION: us-west-2
  auth_7-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/auth_7.test.ts
      CLI_REGION: eu-west-2
  auth_8-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/auth_8.test.ts
      CLI_REGION: eu-central-1
  configure-project-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/configure-project.test.ts
      CLI_REGION: ap-northeast-1
  container-hosting-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/container-hosting.test.ts
      CLI_REGION: ap-southeast-1
  custom_policies_container-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/custom_policies_container.test.ts
      CLI_REGION: ap-southeast-2
  custom_policies_function-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/custom_policies_function.test.ts
      CLI_REGION: us-east-2
  frontend_config_drift-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/frontend_config_drift.test.ts
      CLI_REGION: us-west-2
  function_5-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_5.test.ts
      CLI_REGION: eu-west-2
  function_6-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_6.test.ts
      CLI_REGION: eu-central-1
  function_7-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_7.test.ts
      CLI_REGION: ap-northeast-1
  function_8-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_8.test.ts
      CLI_REGION: ap-southeast-1
  function_9-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_9.test.ts
      CLI_REGION: ap-southeast-2
  hooks-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/hooks.test.ts
      CLI_REGION: us-east-2
  iam-permissions-boundary-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/iam-permissions-boundary.test.ts
      CLI_REGION: us-west-2
  import_auth_3-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/import_auth_3.test.ts
      CLI_REGION: eu-west-2
  import_dynamodb_2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/import_dynamodb_2.test.ts
      CLI_REGION: eu-central-1
  import_s3_2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/import_s3_2.test.ts
      CLI_REGION: ap-northeast-1
  layer-1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/layer-1.test.ts
      CLI_REGION: ap-southeast-1
  layer-2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/layer-2.test.ts
      CLI_REGION: ap-southeast-2
  layer-3-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/layer-3.test.ts
      CLI_REGION: us-east-2
  layer-4-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/layer-4.test.ts
      CLI_REGION: us-west-2
  migration-api-connection-migration2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/migration/api.connection.migration2.test.ts
      CLI_REGION: eu-west-2
  migration-node-function-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/migration/node.function.test.ts
      CLI_REGION: eu-central-1
  pull-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/pull.test.ts
      CLI_REGION: ap-northeast-1
  s3-sse-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/s3-sse.test.ts
      CLI_REGION: ap-southeast-1
  schema-auth-12-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-12.test.ts
      CLI_REGION: ap-southeast-2
  schema-auth-13-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-13.test.ts
      CLI_REGION: us-east-2
  schema-function-1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-function-1.test.ts
      CLI_REGION: us-west-2
  schema-function-2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-function-2.test.ts
      CLI_REGION: eu-west-2
  schema-iterative-update-locking-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-iterative-update-locking.test.ts
      CLI_REGION: eu-central-1
  storage-1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/storage-1.test.ts
      CLI_REGION: ap-northeast-1
  storage-2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/storage-2.test.ts
      CLI_REGION: ap-southeast-1
  storage-3-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/storage-3.test.ts
      CLI_REGION: ap-southeast-2
  plugin-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/plugin.test.ts
      CLI_REGION: us-east-2
  init-special-case-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/init-special-case.test.ts
      CLI_REGION: us-west-2
  datastore-modelgen-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/datastore-modelgen.test.ts
      CLI_REGION: eu-west-2
  amplify-configure-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/amplify-configure.test.ts
      CLI_REGION: eu-central-1
  init-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/init.test.ts
      CLI_REGION: ap-northeast-1
  tags-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/tags.test.ts
      CLI_REGION: ap-southeast-1
  notifications-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/notifications.test.ts
      CLI_REGION: ap-southeast-2
  schema-versioned-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-versioned.test.ts
      CLI_REGION: us-east-2
  schema-data-access-patterns-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-data-access-patterns.test.ts
      CLI_REGION: us-west-2
  interactions-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/interactions.test.ts
      CLI_REGION: us-west-2
  schema-predictions-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-predictions.test.ts
      CLI_REGION: eu-central-1
  amplify-app-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/amplify-app.test.ts
      CLI_REGION: ap-northeast-1
  hosting-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/hosting.test.ts
      CLI_REGION: ap-southeast-1
  analytics-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/analytics.test.ts
      CLI_REGION: ap-southeast-2
  feature-flags-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/feature-flags.test.ts
      CLI_REGION: us-east-2
  schema-iterative-update-2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-iterative-update-2.test.ts
      CLI_REGION: us-west-2
  containers-api-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/containers-api.test.ts
      CLI_REGION: eu-west-2
  predictions-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/predictions.test.ts
      CLI_REGION: eu-central-1
  hostingPROD-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/hostingPROD.test.ts
      CLI_REGION: ap-northeast-1
  geo-add-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/geo-add.test.ts
      CLI_REGION: us-east-2
  geo-update-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/geo-update.test.ts
      CLI_REGION: us-west-2
  geo-remove-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/geo-remove.test.ts
      CLI_REGION: eu-central-1
  schema-auth-10-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-10.test.ts
      CLI_REGION: us-west-2
  schema-key-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-key.test.ts
      CLI_REGION: eu-west-2
  auth_1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/auth_1.test.ts
      CLI_REGION: eu-central-1
  auth_5-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/auth_5.test.ts
      CLI_REGION: ap-northeast-1
  function_3-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_3.test.ts
      CLI_REGION: ap-southeast-1
  schema-iterative-update-1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-iterative-update-1.test.ts
      CLI_REGION: ap-southeast-2
  schema-auth-3-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-3.test.ts
      CLI_REGION: us-east-2
  delete-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/delete.test.ts
      CLI_REGION: us-west-2
  function_2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_2.test.ts
      CLI_REGION: eu-west-2
  auth_3-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/auth_3.test.ts
      CLI_REGION: eu-central-1
  migration-api-key-migration1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/migration/api.key.migration1.test.ts
      CLI_REGION: ap-northeast-1
  auth_4-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/auth_4.test.ts
      CLI_REGION: ap-southeast-1
  schema-auth-7-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-7.test.ts
      CLI_REGION: ap-southeast-2
  schema-auth-8-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-8.test.ts
      CLI_REGION: us-east-2
  schema-searchable-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-searchable.test.ts
      CLI_REGION: us-west-2
  schema-auth-4-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-4.test.ts
      CLI_REGION: eu-west-2
  api_3-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/api_3.test.ts
      CLI_REGION: eu-central-1
  import_auth_1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/import_auth_1.test.ts
      CLI_REGION: ap-northeast-1
  import_auth_2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/import_auth_2.test.ts
      CLI_REGION: ap-southeast-1
  import_s3_1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/import_s3_1.test.ts
      CLI_REGION: ap-southeast-2
      USE_PARENT_ACCOUNT: 1
  import_dynamodb_1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/import_dynamodb_1.test.ts
      CLI_REGION: us-east-2
      USE_PARENT_ACCOUNT: 1
  schema-iterative-rollback-1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-iterative-rollback-1.test.ts
      CLI_REGION: us-west-2
  schema-iterative-rollback-2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-iterative-rollback-2.test.ts
      CLI_REGION: eu-west-2
  env-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/env.test.ts
      CLI_REGION: eu-central-1
  auth_2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/auth_2.test.ts
      CLI_REGION: ap-northeast-1
      USE_PARENT_ACCOUNT: 1
  schema-auth-9-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-9.test.ts
      CLI_REGION: ap-southeast-1
  schema-auth-11-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-11.test.ts
      CLI_REGION: ap-southeast-2
  migration-api-key-migration2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/migration/api.key.migration2.test.ts
      CLI_REGION: us-east-2
      USE_PARENT_ACCOUNT: 1
  function_1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_1.test.ts
      CLI_REGION: us-west-2
  schema-auth-1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-1.test.ts
      CLI_REGION: eu-west-2
  function_4-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/function_4.test.ts
      CLI_REGION: eu-central-1
  schema-model-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-model.test.ts
      CLI_REGION: ap-northeast-1
  migration-api-connection-migration-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/migration/api.connection.migration.test.ts
      CLI_REGION: ap-southeast-1
  schema-connection-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-connection.test.ts
      CLI_REGION: ap-southeast-2
  schema-auth-6-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-6.test.ts
      CLI_REGION: us-east-2
  schema-iterative-update-3-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-iterative-update-3.test.ts
      CLI_REGION: us-west-2
  schema-auth-2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-2.test.ts
      CLI_REGION: eu-west-2
  api_1-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/api_1.test.ts
      CLI_REGION: eu-central-1
      USE_PARENT_ACCOUNT: 1
  schema-auth-5-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-auth-5.test.ts
      CLI_REGION: ap-northeast-1
  api_2-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/api_2.test.ts
      CLI_REGION: ap-southeast-1
      USE_PARENT_ACCOUNT: 1
  api_5-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/api_5.test.ts
      CLI_REGION: ap-southeast-2
  schema-iterative-update-4-amplify_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          name: Run E2e Tests
          command: |
            source .circleci/local_publish_helpers.sh
            retry runE2eTest
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/schema-iterative-update-4.test.ts
      CLI_REGION: us-east-2
  api_4-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/api_4.test.ts
      CLI_REGION: us-east-2
  auth_6-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_6.test.ts
      CLI_REGION: us-west-2
  auth_7-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_7.test.ts
      CLI_REGION: eu-west-2
  auth_8-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_8.test.ts
      CLI_REGION: eu-central-1
  configure-project-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/configure-project.test.ts
      CLI_REGION: ap-northeast-1
  container-hosting-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/container-hosting.test.ts
      CLI_REGION: ap-southeast-1
  custom_policies_container-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/custom_policies_container.test.ts
      CLI_REGION: ap-southeast-2
  custom_policies_function-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/custom_policies_function.test.ts
      CLI_REGION: us-east-2
  frontend_config_drift-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/frontend_config_drift.test.ts
      CLI_REGION: us-west-2
  function_5-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_5.test.ts
      CLI_REGION: eu-west-2
  function_6-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_6.test.ts
      CLI_REGION: eu-central-1
  function_7-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_7.test.ts
      CLI_REGION: ap-northeast-1
  function_8-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_8.test.ts
      CLI_REGION: ap-southeast-1
  function_9-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_9.test.ts
      CLI_REGION: ap-southeast-2
  hooks-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/hooks.test.ts
      CLI_REGION: us-east-2
  iam-permissions-boundary-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/iam-permissions-boundary.test.ts
      CLI_REGION: us-west-2
  import_auth_3-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_auth_3.test.ts
      CLI_REGION: eu-west-2
  import_dynamodb_2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_dynamodb_2.test.ts
      CLI_REGION: eu-central-1
  import_s3_2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_s3_2.test.ts
      CLI_REGION: ap-northeast-1
  layer-1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/layer-1.test.ts
      CLI_REGION: ap-southeast-1
  layer-2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/layer-2.test.ts
      CLI_REGION: ap-southeast-2
  layer-3-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/layer-3.test.ts
      CLI_REGION: us-east-2
  layer-4-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/layer-4.test.ts
      CLI_REGION: us-west-2
  migration-api-connection-migration2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/migration/api.connection.migration2.test.ts
      CLI_REGION: eu-west-2
  migration-node-function-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/migration/node.function.test.ts
      CLI_REGION: eu-central-1
  pull-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/pull.test.ts
      CLI_REGION: ap-northeast-1
  s3-sse-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/s3-sse.test.ts
      CLI_REGION: ap-southeast-1
  schema-auth-12-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-12.test.ts
      CLI_REGION: ap-southeast-2
  schema-auth-13-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-13.test.ts
      CLI_REGION: us-east-2
  schema-function-1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-function-1.test.ts
      CLI_REGION: us-west-2
  schema-function-2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-function-2.test.ts
      CLI_REGION: eu-west-2
  schema-iterative-update-locking-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-iterative-update-locking.test.ts
      CLI_REGION: eu-central-1
  storage-1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/storage-1.test.ts
      CLI_REGION: ap-northeast-1
  storage-2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/storage-2.test.ts
      CLI_REGION: ap-southeast-1
  storage-3-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/storage-3.test.ts
      CLI_REGION: ap-southeast-2
  plugin-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/plugin.test.ts
      CLI_REGION: us-east-2
  init-special-case-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/init-special-case.test.ts
      CLI_REGION: us-west-2
  datastore-modelgen-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/datastore-modelgen.test.ts
      CLI_REGION: eu-west-2
  amplify-configure-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/amplify-configure.test.ts
      CLI_REGION: eu-central-1
  init-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/init.test.ts
      CLI_REGION: ap-northeast-1
  tags-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/tags.test.ts
      CLI_REGION: ap-southeast-1
  notifications-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/notifications.test.ts
      CLI_REGION: ap-southeast-2
  schema-versioned-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-versioned.test.ts
      CLI_REGION: us-east-2
  schema-data-access-patterns-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-data-access-patterns.test.ts
      CLI_REGION: us-west-2
  interactions-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/interactions.test.ts
      CLI_REGION: us-west-2
  schema-predictions-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-predictions.test.ts
      CLI_REGION: eu-central-1
  amplify-app-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/amplify-app.test.ts
      CLI_REGION: ap-northeast-1
  hosting-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/hosting.test.ts
      CLI_REGION: ap-southeast-1
  analytics-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/analytics.test.ts
      CLI_REGION: ap-southeast-2
  feature-flags-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/feature-flags.test.ts
      CLI_REGION: us-east-2
  schema-iterative-update-2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-iterative-update-2.test.ts
      CLI_REGION: us-west-2
  containers-api-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/containers-api.test.ts
      CLI_REGION: eu-west-2
  predictions-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/predictions.test.ts
      CLI_REGION: eu-central-1
  hostingPROD-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/hostingPROD.test.ts
      CLI_REGION: ap-northeast-1
  geo-add-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-add.test.ts
      CLI_REGION: us-east-2
  geo-update-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-update.test.ts
      CLI_REGION: us-west-2
  geo-remove-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-remove.test.ts
      CLI_REGION: eu-central-1
  schema-auth-10-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-10.test.ts
      CLI_REGION: us-west-2
  schema-key-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-key.test.ts
      CLI_REGION: eu-west-2
  auth_1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_1.test.ts
      CLI_REGION: eu-central-1
  auth_5-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_5.test.ts
      CLI_REGION: ap-northeast-1
  function_3-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_3.test.ts
      CLI_REGION: ap-southeast-1
  schema-iterative-update-1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-iterative-update-1.test.ts
      CLI_REGION: ap-southeast-2
  schema-auth-3-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-3.test.ts
      CLI_REGION: us-east-2
  delete-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/delete.test.ts
      CLI_REGION: us-west-2
  function_2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_2.test.ts
      CLI_REGION: eu-west-2
  auth_3-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_3.test.ts
      CLI_REGION: eu-central-1
  migration-api-key-migration1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/migration/api.key.migration1.test.ts
      CLI_REGION: ap-northeast-1
  auth_4-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_4.test.ts
      CLI_REGION: ap-southeast-1
  schema-auth-7-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-7.test.ts
      CLI_REGION: ap-southeast-2
  schema-auth-8-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-8.test.ts
      CLI_REGION: us-east-2
  schema-searchable-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-searchable.test.ts
      CLI_REGION: us-west-2
  schema-auth-4-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-4.test.ts
      CLI_REGION: eu-west-2
  api_3-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/api_3.test.ts
      CLI_REGION: eu-central-1
  import_auth_1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_auth_1.test.ts
      CLI_REGION: ap-northeast-1
  import_auth_2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_auth_2.test.ts
      CLI_REGION: ap-southeast-1
  import_s3_1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_s3_1.test.ts
      CLI_REGION: ap-southeast-2
      USE_PARENT_ACCOUNT: 1
  import_dynamodb_1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_dynamodb_1.test.ts
      CLI_REGION: us-east-2
      USE_PARENT_ACCOUNT: 1
  schema-iterative-rollback-1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-iterative-rollback-1.test.ts
      CLI_REGION: us-west-2
  schema-iterative-rollback-2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-iterative-rollback-2.test.ts
      CLI_REGION: eu-west-2
  env-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/env.test.ts
      CLI_REGION: eu-central-1
  auth_2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_2.test.ts
      CLI_REGION: ap-northeast-1
      USE_PARENT_ACCOUNT: 1
  schema-auth-9-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-9.test.ts
      CLI_REGION: ap-southeast-1
  schema-auth-11-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-11.test.ts
      CLI_REGION: ap-southeast-2
  migration-api-key-migration2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/migration/api.key.migration2.test.ts
      CLI_REGION: us-east-2
      USE_PARENT_ACCOUNT: 1
  function_1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_1.test.ts
      CLI_REGION: us-west-2
  schema-auth-1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-1.test.ts
      CLI_REGION: eu-west-2
  function_4-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/function_4.test.ts
      CLI_REGION: eu-central-1
  schema-model-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-model.test.ts
      CLI_REGION: ap-northeast-1
  migration-api-connection-migration-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/migration/api.connection.migration.test.ts
      CLI_REGION: ap-southeast-1
  schema-connection-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-connection.test.ts
      CLI_REGION: ap-southeast-2
  schema-auth-6-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-6.test.ts
      CLI_REGION: us-east-2
  schema-iterative-update-3-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-iterative-update-3.test.ts
      CLI_REGION: us-west-2
  schema-auth-2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-2.test.ts
      CLI_REGION: eu-west-2
  api_1-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/api_1.test.ts
      CLI_REGION: eu-central-1
      USE_PARENT_ACCOUNT: 1
  schema-auth-5-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-5.test.ts
      CLI_REGION: ap-northeast-1
  api_2-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/api_2.test.ts
      CLI_REGION: ap-southeast-1
      USE_PARENT_ACCOUNT: 1
  api_5-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/api_5.test.ts
      CLI_REGION: ap-southeast-2
  schema-iterative-update-4-amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: os.linux
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}-{{ arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - install_yarn:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: packages/amplify-e2e-tests/
      - store_artifacts:
          path: packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-iterative-update-4.test.ts
      CLI_REGION: us-east-2
  ConnectionsWithAuthTests-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/ConnectionsWithAuthTests.e2e.test.ts
      CLI_REGION: us-east-2
  CustomRoots-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/CustomRoots.e2e.test.ts
      CLI_REGION: us-west-2
  DynamoDBModelTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/DynamoDBModelTransformer.e2e.test.ts
      CLI_REGION: eu-west-2
  FunctionTransformerTests-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/FunctionTransformerTests.e2e.test.ts
      CLI_REGION: eu-central-1
  HttpTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/HttpTransformer.e2e.test.ts
      CLI_REGION: ap-northeast-1
  IndexTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/IndexTransformer.e2e.test.ts
      CLI_REGION: ap-southeast-1
  KeyTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/KeyTransformer.e2e.test.ts
      CLI_REGION: ap-southeast-2
  KeyTransformerLocal-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/KeyTransformerLocal.e2e.test.ts
      CLI_REGION: us-east-2
  KeyWithAuth-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/KeyWithAuth.e2e.test.ts
      CLI_REGION: us-west-2
  ModelAuthTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/ModelAuthTransformer.e2e.test.ts
      CLI_REGION: eu-west-2
  ModelConnectionTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/ModelConnectionTransformer.e2e.test.ts
      CLI_REGION: eu-central-1
  ModelConnectionWithKeyTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/ModelConnectionWithKeyTransformer.e2e.test.ts
      CLI_REGION: ap-northeast-1
  ModelTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/ModelTransformer.e2e.test.ts
      CLI_REGION: ap-southeast-1
  MultiAuthModelAuthTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/MultiAuthModelAuthTransformer.e2e.test.ts
      CLI_REGION: ap-southeast-2
  MutationCondition-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/MutationCondition.e2e.test.ts
      CLI_REGION: us-east-2
  NestedStacksTest-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/NestedStacksTest.e2e.test.ts
      CLI_REGION: us-west-2
  NewConnectionTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/NewConnectionTransformer.e2e.test.ts
      CLI_REGION: eu-west-2
  NewConnectionWithAuth-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/NewConnectionWithAuth.e2e.test.ts
      CLI_REGION: eu-central-1
  NoneEnvFunctionTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/NoneEnvFunctionTransformer.e2e.test.ts
      CLI_REGION: ap-northeast-1
  NonModelAuthFunction-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/NonModelAuthFunction.e2e.test.ts
      CLI_REGION: ap-southeast-1
  PerFieldAuthTests-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/PerFieldAuthTests.e2e.test.ts
      CLI_REGION: ap-southeast-2
  PredictionsTransformerTests-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/PredictionsTransformerTests.e2e.test.ts
      CLI_REGION: us-east-2
  RelationalTransformers-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/RelationalTransformers.e2e.test.ts
      CLI_REGION: us-west-2
  SearchableModelTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/SearchableModelTransformer.e2e.test.ts
      CLI_REGION: eu-west-2
  SearchableModelTransformerV2-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/SearchableModelTransformerV2.e2e.test.ts
      CLI_REGION: eu-central-1
  SearchableWithAuthTests-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/SearchableWithAuthTests.e2e.test.ts
      CLI_REGION: ap-northeast-1
  SubscriptionsWithAuthTest-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/SubscriptionsWithAuthTest.e2e.test.ts
      CLI_REGION: ap-southeast-1
  TestComplexStackMappingsLocal-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/TestComplexStackMappingsLocal.e2e.test.ts
      CLI_REGION: ap-southeast-2
  VersionedModelTransformer-e2e-graphql_e2e_tests:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - run:
          name: Run GraphQL end-to-end tests
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/graphql-transformers-e2e-tests/
            retry yarn e2e --maxWorkers=3 $TEST_SUITE
          environment:
            AMPLIFY_CLI_DISABLE_LOGGING: 'true'
          no_output_timeout: 90m
      - store_test_results:
          path: packages/graphql-transformers-e2e-tests/
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/VersionedModelTransformer.e2e.test.ts
      CLI_REGION: us-east-2
  migration_tests-auth-deployment-migration-auth-deployment-secrets-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/auth-deployment-migration/auth.deployment.secrets.test.ts
      CLI_REGION: us-east-2
  migration_tests-lambda-layer-migration-layer-migration-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/lambda-layer-migration/layer-migration.test.ts
      CLI_REGION: us-west-2
  migration_tests-transformer_migration-api-key-migration-2-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.key.migration-2.test.ts
      CLI_REGION: eu-west-2
  migration_tests-transformer_migration-api-key-migration-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.key.migration.test.ts
      CLI_REGION: eu-central-1
  migration_tests-transformer_migration-api-searchable-migration-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.searchable.migration.test.ts
      CLI_REGION: ap-northeast-1
  update_tests-api_migration_update-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/api_migration_update.test.ts
      CLI_REGION: ap-southeast-1
  update_tests-auth_migration_update-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/auth_migration_update.test.ts
      CLI_REGION: ap-southeast-2
  update_tests-function_migration_update-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/function_migration_update.test.ts
      CLI_REGION: us-east-2
  update_tests-storage_migration_update-amplify_migration_tests_v4:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.0.0
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration_v4.0.0 --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/repo/packages/amplify-cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/storage_migration_update.test.ts
      CLI_REGION: us-west-2
  migration_tests-auth-deployment-migration-auth-deployment-secrets-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/auth-deployment-migration/auth.deployment.secrets.test.ts
      CLI_REGION: us-east-2
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  migration_tests-lambda-layer-migration-layer-migration-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/lambda-layer-migration/layer-migration.test.ts
      CLI_REGION: us-west-2
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  migration_tests-transformer_migration-api-key-migration-2-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.key.migration-2.test.ts
      CLI_REGION: eu-west-2
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  migration_tests-transformer_migration-api-key-migration-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.key.migration.test.ts
      CLI_REGION: eu-central-1
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  migration_tests-transformer_migration-api-searchable-migration-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.searchable.migration.test.ts
      CLI_REGION: ap-northeast-1
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  update_tests-api_migration_update-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/api_migration_update.test.ts
      CLI_REGION: ap-southeast-1
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  update_tests-auth_migration_update-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/auth_migration_update.test.ts
      CLI_REGION: ap-southeast-2
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  update_tests-function_migration_update-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/function_migration_update.test.ts
      CLI_REGION: us-east-2
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
  update_tests-storage_migration_update-amplify_migration_tests_latest:
    environment:
      AMPLIFY_DIR: /home/circleci/repo/packages/amplify-cli/bin
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/storage_migration_update.test.ts
      CLI_REGION: us-west-2
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: linux
    executor: << parameters.os >>
    steps:
      - attach_workspace:
          at: ./
      - restore_cache:
          key: >-
            amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}-{{
            arch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from latest CLI
          command: |
            source .circleci/local_publish_helpers.sh
            changeNpmGlobalPath
            cd packages/amplify-migration-tests
            retry yarn run migration --maxWorkers=3 $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
workflows:
  version: 2
  nightly_console_integration_tests:
    triggers:
      - schedule:
          cron: 0 14 * * *
          filters:
            branches:
              only:
                - master
    jobs:
      - build
      - publish_to_local_registry:
          requires:
            - build
      - amplify_console_integration_tests:
          context:
            - amplify-ecr-image-pull
            - console-e2e-test
            - e2e-auth-credentials
            - e2e-test-context
          requires:
            - build
            - publish_to_local_registry
  e2e_resource_cleanup:
    triggers:
      - schedule:
          cron: 45 0,12 * * *
          filters:
            branches:
              only:
                - master
    jobs:
      - build
      - cleanup_resources:
          context:
            - cleanup-resources
            - e2e-test-context
          requires:
            - build
  build_test_deploy:
    jobs:
      - build:
          matrix:
            parameters:
              os:
                - linux
                - windows
      - test:
          requires:
            - build
      - mock_e2e_tests:
          requires:
            - build
      - integration_test:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - beta
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
      - publish_to_local_registry:
          filters:
            branches:
              only:
                - master
                - beta
                - release
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
      - build_pkg_binaries:
          requires:
            - publish_to_local_registry
      - amplify_sudo_install_test:
          context: amplify-ecr-image-pull
          requires:
            - publish_to_local_registry
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
      - amplify_migration_tests_v4_30_0:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
      - amplify_migration_tests_non_multi_env_layers:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
      - amplify_migration_tests_multi_env_layers:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
      - amplify_console_integration_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - console-e2e-test
            - e2e-test-context
          filters:
            branches:
              only:
                - beta
          requires:
            - build
            - publish_to_local_registry
      - github_prerelease:
          context: github-publish
          requires:
            - build_pkg_binaries
          filters:
            branches:
              only:
                - release
      - github_prerelease_install_sanity_check:
          requires:
            - github_prerelease
          filters:
            branches:
              only:
                - release
      - cleanup_resources_after_e2e_runs:
          context:
            - cleanup-resources
            - e2e-test-context
          requires:
            - amplify_migration_tests_v4_30_0
            - api_4-amplify_e2e_tests
            - custom_policies_function-amplify_e2e_tests
            - hooks-amplify_e2e_tests
            - layer-3-amplify_e2e_tests
            - schema-auth-13-amplify_e2e_tests
            - plugin-amplify_e2e_tests
            - schema-versioned-amplify_e2e_tests
            - feature-flags-amplify_e2e_tests
            - geo-add-amplify_e2e_tests
            - schema-auth-3-amplify_e2e_tests
            - schema-auth-8-amplify_e2e_tests
            - import_dynamodb_1-amplify_e2e_tests
            - migration-api-key-migration2-amplify_e2e_tests
            - schema-auth-6-amplify_e2e_tests
            - schema-iterative-update-4-amplify_e2e_tests
            - auth_6-amplify_e2e_tests
            - frontend_config_drift-amplify_e2e_tests
            - iam-permissions-boundary-amplify_e2e_tests
            - layer-4-amplify_e2e_tests
            - schema-function-1-amplify_e2e_tests
            - init-special-case-amplify_e2e_tests
            - schema-data-access-patterns-amplify_e2e_tests
            - interactions-amplify_e2e_tests
            - schema-iterative-update-2-amplify_e2e_tests
            - geo-update-amplify_e2e_tests
            - schema-auth-10-amplify_e2e_tests
            - delete-amplify_e2e_tests
            - schema-searchable-amplify_e2e_tests
            - schema-iterative-rollback-1-amplify_e2e_tests
            - function_1-amplify_e2e_tests
            - schema-iterative-update-3-amplify_e2e_tests
            - auth_7-amplify_e2e_tests
            - function_5-amplify_e2e_tests
            - import_auth_3-amplify_e2e_tests
            - migration-api-connection-migration2-amplify_e2e_tests
            - schema-function-2-amplify_e2e_tests
            - datastore-modelgen-amplify_e2e_tests
            - containers-api-amplify_e2e_tests
            - schema-key-amplify_e2e_tests
            - function_2-amplify_e2e_tests
            - schema-auth-4-amplify_e2e_tests
            - schema-iterative-rollback-2-amplify_e2e_tests
            - schema-auth-1-amplify_e2e_tests
            - schema-auth-2-amplify_e2e_tests
            - auth_8-amplify_e2e_tests
            - function_6-amplify_e2e_tests
            - import_dynamodb_2-amplify_e2e_tests
            - migration-node-function-amplify_e2e_tests
            - schema-iterative-update-locking-amplify_e2e_tests
            - amplify-configure-amplify_e2e_tests
            - schema-predictions-amplify_e2e_tests
            - predictions-amplify_e2e_tests
            - geo-remove-amplify_e2e_tests
            - auth_1-amplify_e2e_tests
            - auth_3-amplify_e2e_tests
            - api_3-amplify_e2e_tests
            - env-amplify_e2e_tests
            - function_4-amplify_e2e_tests
            - api_1-amplify_e2e_tests
            - configure-project-amplify_e2e_tests
            - function_7-amplify_e2e_tests
            - import_s3_2-amplify_e2e_tests
            - pull-amplify_e2e_tests
            - storage-1-amplify_e2e_tests
            - init-amplify_e2e_tests
            - amplify-app-amplify_e2e_tests
            - hostingPROD-amplify_e2e_tests
            - auth_5-amplify_e2e_tests
            - migration-api-key-migration1-amplify_e2e_tests
            - import_auth_1-amplify_e2e_tests
            - auth_2-amplify_e2e_tests
            - schema-model-amplify_e2e_tests
            - schema-auth-5-amplify_e2e_tests
            - container-hosting-amplify_e2e_tests
            - function_8-amplify_e2e_tests
            - layer-1-amplify_e2e_tests
            - s3-sse-amplify_e2e_tests
            - storage-2-amplify_e2e_tests
            - tags-amplify_e2e_tests
            - hosting-amplify_e2e_tests
            - function_3-amplify_e2e_tests
            - auth_4-amplify_e2e_tests
            - import_auth_2-amplify_e2e_tests
            - schema-auth-9-amplify_e2e_tests
            - migration-api-connection-migration-amplify_e2e_tests
            - api_2-amplify_e2e_tests
            - custom_policies_container-amplify_e2e_tests
            - function_9-amplify_e2e_tests
            - layer-2-amplify_e2e_tests
            - schema-auth-12-amplify_e2e_tests
            - storage-3-amplify_e2e_tests
            - notifications-amplify_e2e_tests
            - analytics-amplify_e2e_tests
            - schema-iterative-update-1-amplify_e2e_tests
            - schema-auth-7-amplify_e2e_tests
            - import_s3_1-amplify_e2e_tests
            - schema-auth-11-amplify_e2e_tests
            - schema-connection-amplify_e2e_tests
            - api_5-amplify_e2e_tests
            - api_4-amplify_e2e_tests_pkg
            - custom_policies_function-amplify_e2e_tests_pkg
            - hooks-amplify_e2e_tests_pkg
            - layer-3-amplify_e2e_tests_pkg
            - schema-auth-13-amplify_e2e_tests_pkg
            - plugin-amplify_e2e_tests_pkg
            - schema-versioned-amplify_e2e_tests_pkg
            - feature-flags-amplify_e2e_tests_pkg
            - geo-add-amplify_e2e_tests_pkg
            - schema-auth-3-amplify_e2e_tests_pkg
            - schema-auth-8-amplify_e2e_tests_pkg
            - import_dynamodb_1-amplify_e2e_tests_pkg
            - migration-api-key-migration2-amplify_e2e_tests_pkg
            - schema-auth-6-amplify_e2e_tests_pkg
            - schema-iterative-update-4-amplify_e2e_tests_pkg
            - auth_6-amplify_e2e_tests_pkg
            - frontend_config_drift-amplify_e2e_tests_pkg
            - iam-permissions-boundary-amplify_e2e_tests_pkg
            - layer-4-amplify_e2e_tests_pkg
            - schema-function-1-amplify_e2e_tests_pkg
            - init-special-case-amplify_e2e_tests_pkg
            - schema-data-access-patterns-amplify_e2e_tests_pkg
            - interactions-amplify_e2e_tests_pkg
            - schema-iterative-update-2-amplify_e2e_tests_pkg
            - geo-update-amplify_e2e_tests_pkg
            - schema-auth-10-amplify_e2e_tests_pkg
            - delete-amplify_e2e_tests_pkg
            - schema-searchable-amplify_e2e_tests_pkg
            - schema-iterative-rollback-1-amplify_e2e_tests_pkg
            - function_1-amplify_e2e_tests_pkg
            - schema-iterative-update-3-amplify_e2e_tests_pkg
            - auth_7-amplify_e2e_tests_pkg
            - function_5-amplify_e2e_tests_pkg
            - import_auth_3-amplify_e2e_tests_pkg
            - migration-api-connection-migration2-amplify_e2e_tests_pkg
            - schema-function-2-amplify_e2e_tests_pkg
            - datastore-modelgen-amplify_e2e_tests_pkg
            - containers-api-amplify_e2e_tests_pkg
            - schema-key-amplify_e2e_tests_pkg
            - function_2-amplify_e2e_tests_pkg
            - schema-auth-4-amplify_e2e_tests_pkg
            - schema-iterative-rollback-2-amplify_e2e_tests_pkg
            - schema-auth-1-amplify_e2e_tests_pkg
            - schema-auth-2-amplify_e2e_tests_pkg
            - auth_8-amplify_e2e_tests_pkg
            - function_6-amplify_e2e_tests_pkg
            - import_dynamodb_2-amplify_e2e_tests_pkg
            - migration-node-function-amplify_e2e_tests_pkg
            - schema-iterative-update-locking-amplify_e2e_tests_pkg
            - amplify-configure-amplify_e2e_tests_pkg
            - schema-predictions-amplify_e2e_tests_pkg
            - predictions-amplify_e2e_tests_pkg
            - geo-remove-amplify_e2e_tests_pkg
            - auth_1-amplify_e2e_tests_pkg
            - auth_3-amplify_e2e_tests_pkg
            - api_3-amplify_e2e_tests_pkg
            - env-amplify_e2e_tests_pkg
            - function_4-amplify_e2e_tests_pkg
            - api_1-amplify_e2e_tests_pkg
            - configure-project-amplify_e2e_tests_pkg
            - function_7-amplify_e2e_tests_pkg
            - import_s3_2-amplify_e2e_tests_pkg
            - pull-amplify_e2e_tests_pkg
            - storage-1-amplify_e2e_tests_pkg
            - init-amplify_e2e_tests_pkg
            - amplify-app-amplify_e2e_tests_pkg
            - hostingPROD-amplify_e2e_tests_pkg
            - auth_5-amplify_e2e_tests_pkg
            - migration-api-key-migration1-amplify_e2e_tests_pkg
            - import_auth_1-amplify_e2e_tests_pkg
            - auth_2-amplify_e2e_tests_pkg
            - schema-model-amplify_e2e_tests_pkg
            - schema-auth-5-amplify_e2e_tests_pkg
            - container-hosting-amplify_e2e_tests_pkg
            - function_8-amplify_e2e_tests_pkg
            - layer-1-amplify_e2e_tests_pkg
            - s3-sse-amplify_e2e_tests_pkg
            - storage-2-amplify_e2e_tests_pkg
            - tags-amplify_e2e_tests_pkg
            - hosting-amplify_e2e_tests_pkg
            - function_3-amplify_e2e_tests_pkg
            - auth_4-amplify_e2e_tests_pkg
            - import_auth_2-amplify_e2e_tests_pkg
            - schema-auth-9-amplify_e2e_tests_pkg
            - migration-api-connection-migration-amplify_e2e_tests_pkg
            - api_2-amplify_e2e_tests_pkg
            - custom_policies_container-amplify_e2e_tests_pkg
            - function_9-amplify_e2e_tests_pkg
            - layer-2-amplify_e2e_tests_pkg
            - schema-auth-12-amplify_e2e_tests_pkg
            - storage-3-amplify_e2e_tests_pkg
            - notifications-amplify_e2e_tests_pkg
            - analytics-amplify_e2e_tests_pkg
            - schema-iterative-update-1-amplify_e2e_tests_pkg
            - schema-auth-7-amplify_e2e_tests_pkg
            - import_s3_1-amplify_e2e_tests_pkg
            - schema-auth-11-amplify_e2e_tests_pkg
            - schema-connection-amplify_e2e_tests_pkg
            - api_5-amplify_e2e_tests_pkg
            - >-
              migration_tests-auth-deployment-migration-auth-deployment-secrets-amplify_migration_tests_v4
            - update_tests-function_migration_update-amplify_migration_tests_v4
            - >-
              migration_tests-lambda-layer-migration-layer-migration-amplify_migration_tests_v4
            - update_tests-storage_migration_update-amplify_migration_tests_v4
            - >-
              migration_tests-transformer_migration-api-key-migration-2-amplify_migration_tests_v4
            - >-
              migration_tests-transformer_migration-api-key-migration-amplify_migration_tests_v4
            - >-
              migration_tests-transformer_migration-api-searchable-migration-amplify_migration_tests_v4
            - update_tests-api_migration_update-amplify_migration_tests_v4
            - update_tests-auth_migration_update-amplify_migration_tests_v4
            - >-
              migration_tests-auth-deployment-migration-auth-deployment-secrets-amplify_migration_tests_latest
            - >-
              update_tests-function_migration_update-amplify_migration_tests_latest
            - >-
              migration_tests-lambda-layer-migration-layer-migration-amplify_migration_tests_latest
            - >-
              update_tests-storage_migration_update-amplify_migration_tests_latest
            - >-
              migration_tests-transformer_migration-api-key-migration-2-amplify_migration_tests_latest
            - >-
              migration_tests-transformer_migration-api-key-migration-amplify_migration_tests_latest
            - >-
              migration_tests-transformer_migration-api-searchable-migration-amplify_migration_tests_latest
            - update_tests-api_migration_update-amplify_migration_tests_latest
            - update_tests-auth_migration_update-amplify_migration_tests_latest
      - deploy:
          context:
            - amplify-ecr-image-pull
            - npm-publish
          requires:
            - test
            - mock_e2e_tests
            - integration_test
            - amplify_sudo_install_test
            - amplify_console_integration_tests
            - amplify_migration_tests_v4_30_0
            - amplify_migration_tests_non_multi_env_layers
            - amplify_migration_tests_multi_env_layers
            - github_prerelease_install_sanity_check
            - api_4-amplify_e2e_tests
            - custom_policies_function-amplify_e2e_tests
            - hooks-amplify_e2e_tests
            - layer-3-amplify_e2e_tests
            - schema-auth-13-amplify_e2e_tests
            - plugin-amplify_e2e_tests
            - schema-versioned-amplify_e2e_tests
            - feature-flags-amplify_e2e_tests
            - geo-add-amplify_e2e_tests
            - schema-auth-3-amplify_e2e_tests
            - schema-auth-8-amplify_e2e_tests
            - import_dynamodb_1-amplify_e2e_tests
            - migration-api-key-migration2-amplify_e2e_tests
            - schema-auth-6-amplify_e2e_tests
            - schema-iterative-update-4-amplify_e2e_tests
            - auth_6-amplify_e2e_tests
            - frontend_config_drift-amplify_e2e_tests
            - iam-permissions-boundary-amplify_e2e_tests
            - layer-4-amplify_e2e_tests
            - schema-function-1-amplify_e2e_tests
            - init-special-case-amplify_e2e_tests
            - schema-data-access-patterns-amplify_e2e_tests
            - interactions-amplify_e2e_tests
            - schema-iterative-update-2-amplify_e2e_tests
            - geo-update-amplify_e2e_tests
            - schema-auth-10-amplify_e2e_tests
            - delete-amplify_e2e_tests
            - schema-searchable-amplify_e2e_tests
            - schema-iterative-rollback-1-amplify_e2e_tests
            - function_1-amplify_e2e_tests
            - schema-iterative-update-3-amplify_e2e_tests
            - auth_7-amplify_e2e_tests
            - function_5-amplify_e2e_tests
            - import_auth_3-amplify_e2e_tests
            - migration-api-connection-migration2-amplify_e2e_tests
            - schema-function-2-amplify_e2e_tests
            - datastore-modelgen-amplify_e2e_tests
            - containers-api-amplify_e2e_tests
            - schema-key-amplify_e2e_tests
            - function_2-amplify_e2e_tests
            - schema-auth-4-amplify_e2e_tests
            - schema-iterative-rollback-2-amplify_e2e_tests
            - schema-auth-1-amplify_e2e_tests
            - schema-auth-2-amplify_e2e_tests
            - auth_8-amplify_e2e_tests
            - function_6-amplify_e2e_tests
            - import_dynamodb_2-amplify_e2e_tests
            - migration-node-function-amplify_e2e_tests
            - schema-iterative-update-locking-amplify_e2e_tests
            - amplify-configure-amplify_e2e_tests
            - schema-predictions-amplify_e2e_tests
            - predictions-amplify_e2e_tests
            - geo-remove-amplify_e2e_tests
            - auth_1-amplify_e2e_tests
            - auth_3-amplify_e2e_tests
            - api_3-amplify_e2e_tests
            - env-amplify_e2e_tests
            - function_4-amplify_e2e_tests
            - api_1-amplify_e2e_tests
            - configure-project-amplify_e2e_tests
            - function_7-amplify_e2e_tests
            - import_s3_2-amplify_e2e_tests
            - pull-amplify_e2e_tests
            - storage-1-amplify_e2e_tests
            - init-amplify_e2e_tests
            - amplify-app-amplify_e2e_tests
            - hostingPROD-amplify_e2e_tests
            - auth_5-amplify_e2e_tests
            - migration-api-key-migration1-amplify_e2e_tests
            - import_auth_1-amplify_e2e_tests
            - auth_2-amplify_e2e_tests
            - schema-model-amplify_e2e_tests
            - schema-auth-5-amplify_e2e_tests
            - container-hosting-amplify_e2e_tests
            - function_8-amplify_e2e_tests
            - layer-1-amplify_e2e_tests
            - s3-sse-amplify_e2e_tests
            - storage-2-amplify_e2e_tests
            - tags-amplify_e2e_tests
            - hosting-amplify_e2e_tests
            - function_3-amplify_e2e_tests
            - auth_4-amplify_e2e_tests
            - import_auth_2-amplify_e2e_tests
            - schema-auth-9-amplify_e2e_tests
            - migration-api-connection-migration-amplify_e2e_tests
            - api_2-amplify_e2e_tests
            - custom_policies_container-amplify_e2e_tests
            - function_9-amplify_e2e_tests
            - layer-2-amplify_e2e_tests
            - schema-auth-12-amplify_e2e_tests
            - storage-3-amplify_e2e_tests
            - notifications-amplify_e2e_tests
            - analytics-amplify_e2e_tests
            - schema-iterative-update-1-amplify_e2e_tests
            - schema-auth-7-amplify_e2e_tests
            - import_s3_1-amplify_e2e_tests
            - schema-auth-11-amplify_e2e_tests
            - schema-connection-amplify_e2e_tests
            - api_5-amplify_e2e_tests
            - api_4-amplify_e2e_tests_pkg
            - custom_policies_function-amplify_e2e_tests_pkg
            - hooks-amplify_e2e_tests_pkg
            - layer-3-amplify_e2e_tests_pkg
            - schema-auth-13-amplify_e2e_tests_pkg
            - plugin-amplify_e2e_tests_pkg
            - schema-versioned-amplify_e2e_tests_pkg
            - feature-flags-amplify_e2e_tests_pkg
            - geo-add-amplify_e2e_tests_pkg
            - schema-auth-3-amplify_e2e_tests_pkg
            - schema-auth-8-amplify_e2e_tests_pkg
            - import_dynamodb_1-amplify_e2e_tests_pkg
            - migration-api-key-migration2-amplify_e2e_tests_pkg
            - schema-auth-6-amplify_e2e_tests_pkg
            - schema-iterative-update-4-amplify_e2e_tests_pkg
            - auth_6-amplify_e2e_tests_pkg
            - frontend_config_drift-amplify_e2e_tests_pkg
            - iam-permissions-boundary-amplify_e2e_tests_pkg
            - layer-4-amplify_e2e_tests_pkg
            - schema-function-1-amplify_e2e_tests_pkg
            - init-special-case-amplify_e2e_tests_pkg
            - schema-data-access-patterns-amplify_e2e_tests_pkg
            - interactions-amplify_e2e_tests_pkg
            - schema-iterative-update-2-amplify_e2e_tests_pkg
            - geo-update-amplify_e2e_tests_pkg
            - schema-auth-10-amplify_e2e_tests_pkg
            - delete-amplify_e2e_tests_pkg
            - schema-searchable-amplify_e2e_tests_pkg
            - schema-iterative-rollback-1-amplify_e2e_tests_pkg
            - function_1-amplify_e2e_tests_pkg
            - schema-iterative-update-3-amplify_e2e_tests_pkg
            - auth_7-amplify_e2e_tests_pkg
            - function_5-amplify_e2e_tests_pkg
            - import_auth_3-amplify_e2e_tests_pkg
            - migration-api-connection-migration2-amplify_e2e_tests_pkg
            - schema-function-2-amplify_e2e_tests_pkg
            - datastore-modelgen-amplify_e2e_tests_pkg
            - containers-api-amplify_e2e_tests_pkg
            - schema-key-amplify_e2e_tests_pkg
            - function_2-amplify_e2e_tests_pkg
            - schema-auth-4-amplify_e2e_tests_pkg
            - schema-iterative-rollback-2-amplify_e2e_tests_pkg
            - schema-auth-1-amplify_e2e_tests_pkg
            - schema-auth-2-amplify_e2e_tests_pkg
            - auth_8-amplify_e2e_tests_pkg
            - function_6-amplify_e2e_tests_pkg
            - import_dynamodb_2-amplify_e2e_tests_pkg
            - migration-node-function-amplify_e2e_tests_pkg
            - schema-iterative-update-locking-amplify_e2e_tests_pkg
            - amplify-configure-amplify_e2e_tests_pkg
            - schema-predictions-amplify_e2e_tests_pkg
            - predictions-amplify_e2e_tests_pkg
            - geo-remove-amplify_e2e_tests_pkg
            - auth_1-amplify_e2e_tests_pkg
            - auth_3-amplify_e2e_tests_pkg
            - api_3-amplify_e2e_tests_pkg
            - env-amplify_e2e_tests_pkg
            - function_4-amplify_e2e_tests_pkg
            - api_1-amplify_e2e_tests_pkg
            - configure-project-amplify_e2e_tests_pkg
            - function_7-amplify_e2e_tests_pkg
            - import_s3_2-amplify_e2e_tests_pkg
            - pull-amplify_e2e_tests_pkg
            - storage-1-amplify_e2e_tests_pkg
            - init-amplify_e2e_tests_pkg
            - amplify-app-amplify_e2e_tests_pkg
            - hostingPROD-amplify_e2e_tests_pkg
            - auth_5-amplify_e2e_tests_pkg
            - migration-api-key-migration1-amplify_e2e_tests_pkg
            - import_auth_1-amplify_e2e_tests_pkg
            - auth_2-amplify_e2e_tests_pkg
            - schema-model-amplify_e2e_tests_pkg
            - schema-auth-5-amplify_e2e_tests_pkg
            - container-hosting-amplify_e2e_tests_pkg
            - function_8-amplify_e2e_tests_pkg
            - layer-1-amplify_e2e_tests_pkg
            - s3-sse-amplify_e2e_tests_pkg
            - storage-2-amplify_e2e_tests_pkg
            - tags-amplify_e2e_tests_pkg
            - hosting-amplify_e2e_tests_pkg
            - function_3-amplify_e2e_tests_pkg
            - auth_4-amplify_e2e_tests_pkg
            - import_auth_2-amplify_e2e_tests_pkg
            - schema-auth-9-amplify_e2e_tests_pkg
            - migration-api-connection-migration-amplify_e2e_tests_pkg
            - api_2-amplify_e2e_tests_pkg
            - custom_policies_container-amplify_e2e_tests_pkg
            - function_9-amplify_e2e_tests_pkg
            - layer-2-amplify_e2e_tests_pkg
            - schema-auth-12-amplify_e2e_tests_pkg
            - storage-3-amplify_e2e_tests_pkg
            - notifications-amplify_e2e_tests_pkg
            - analytics-amplify_e2e_tests_pkg
            - schema-iterative-update-1-amplify_e2e_tests_pkg
            - schema-auth-7-amplify_e2e_tests_pkg
            - import_s3_1-amplify_e2e_tests_pkg
            - schema-auth-11-amplify_e2e_tests_pkg
            - schema-connection-amplify_e2e_tests_pkg
            - api_5-amplify_e2e_tests_pkg
            - ConnectionsWithAuthTests-e2e-graphql_e2e_tests
            - KeyTransformerLocal-e2e-graphql_e2e_tests
            - MutationCondition-e2e-graphql_e2e_tests
            - PredictionsTransformerTests-e2e-graphql_e2e_tests
            - VersionedModelTransformer-e2e-graphql_e2e_tests
            - CustomRoots-e2e-graphql_e2e_tests
            - KeyWithAuth-e2e-graphql_e2e_tests
            - NestedStacksTest-e2e-graphql_e2e_tests
            - RelationalTransformers-e2e-graphql_e2e_tests
            - DynamoDBModelTransformer-e2e-graphql_e2e_tests
            - ModelAuthTransformer-e2e-graphql_e2e_tests
            - NewConnectionTransformer-e2e-graphql_e2e_tests
            - SearchableModelTransformer-e2e-graphql_e2e_tests
            - FunctionTransformerTests-e2e-graphql_e2e_tests
            - ModelConnectionTransformer-e2e-graphql_e2e_tests
            - NewConnectionWithAuth-e2e-graphql_e2e_tests
            - SearchableModelTransformerV2-e2e-graphql_e2e_tests
            - HttpTransformer-e2e-graphql_e2e_tests
            - ModelConnectionWithKeyTransformer-e2e-graphql_e2e_tests
            - NoneEnvFunctionTransformer-e2e-graphql_e2e_tests
            - SearchableWithAuthTests-e2e-graphql_e2e_tests
            - IndexTransformer-e2e-graphql_e2e_tests
            - ModelTransformer-e2e-graphql_e2e_tests
            - NonModelAuthFunction-e2e-graphql_e2e_tests
            - SubscriptionsWithAuthTest-e2e-graphql_e2e_tests
            - KeyTransformer-e2e-graphql_e2e_tests
            - MultiAuthModelAuthTransformer-e2e-graphql_e2e_tests
            - PerFieldAuthTests-e2e-graphql_e2e_tests
            - TestComplexStackMappingsLocal-e2e-graphql_e2e_tests
            - >-
              migration_tests-auth-deployment-migration-auth-deployment-secrets-amplify_migration_tests_v4
            - update_tests-function_migration_update-amplify_migration_tests_v4
            - >-
              migration_tests-lambda-layer-migration-layer-migration-amplify_migration_tests_v4
            - update_tests-storage_migration_update-amplify_migration_tests_v4
            - >-
              migration_tests-transformer_migration-api-key-migration-2-amplify_migration_tests_v4
            - >-
              migration_tests-transformer_migration-api-key-migration-amplify_migration_tests_v4
            - >-
              migration_tests-transformer_migration-api-searchable-migration-amplify_migration_tests_v4
            - update_tests-api_migration_update-amplify_migration_tests_v4
            - update_tests-auth_migration_update-amplify_migration_tests_v4
            - >-
              migration_tests-auth-deployment-migration-auth-deployment-secrets-amplify_migration_tests_latest
            - >-
              update_tests-function_migration_update-amplify_migration_tests_latest
            - >-
              migration_tests-lambda-layer-migration-layer-migration-amplify_migration_tests_latest
            - >-
              update_tests-storage_migration_update-amplify_migration_tests_latest
            - >-
              migration_tests-transformer_migration-api-key-migration-2-amplify_migration_tests_latest
            - >-
              migration_tests-transformer_migration-api-key-migration-amplify_migration_tests_latest
            - >-
              migration_tests-transformer_migration-api-searchable-migration-amplify_migration_tests_latest
            - update_tests-api_migration_update-amplify_migration_tests_latest
            - update_tests-auth_migration_update-amplify_migration_tests_latest
          filters:
            branches:
              only:
                - release
                - master
                - beta
                - /tagged-release\/.*/
                - /tagged-release-without-e2e-tests\/.*/
      - github_release:
          context: github-publish
          requires:
            - deploy
          filters:
            branches:
              only:
                - release
      - api_4-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - custom_policies_function-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - hooks-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - layer-3-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-13-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - plugin-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-versioned-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - feature-flags-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - geo-add-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-3-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-8-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - import_dynamodb_1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - migration-api-key-migration2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-6-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-4-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - auth_6-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - frontend_config_drift-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - iam-permissions-boundary-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - layer-4-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-function-1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - init-special-case-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-data-access-patterns-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - interactions-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - geo-update-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-10-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - delete-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-searchable-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-rollback-1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-3-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - auth_7-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_5-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - import_auth_3-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - migration-api-connection-migration2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-function-2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - datastore-modelgen-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - containers-api-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-key-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-4-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-rollback-2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - auth_8-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_6-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - import_dynamodb_2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - migration-node-function-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-locking-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - amplify-configure-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-predictions-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - predictions-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - geo-remove-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - auth_1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - auth_3-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - api_3-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - env-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_4-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - api_1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - configure-project-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_7-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - import_s3_2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - pull-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - storage-1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - init-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - amplify-app-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - hostingPROD-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - auth_5-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - migration-api-key-migration1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - import_auth_1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - auth_2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-model-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-5-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - container-hosting-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_8-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - layer-1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - s3-sse-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - storage-2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - tags-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - hosting-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_3-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - auth_4-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - import_auth_2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-9-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - migration-api-connection-migration-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - api_2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - custom_policies_container-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - function_9-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - layer-2-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-12-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - storage-3-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - notifications-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - analytics-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-7-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - import_s3_1-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-11-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - schema-connection-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - api_5-amplify_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - publish_to_local_registry
          matrix:
            parameters:
              os:
                - linux
      - api_4-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - custom_policies_function-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - hooks-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - layer-3-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-13-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - plugin-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
                - windows
      - schema-versioned-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - feature-flags-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - geo-add-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-3-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-8-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - import_dynamodb_1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - migration-api-key-migration2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-6-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-4-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - auth_6-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - frontend_config_drift-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - iam-permissions-boundary-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - layer-4-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-function-1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - init-special-case-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
                - windows
      - schema-data-access-patterns-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - interactions-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - geo-update-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-10-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - delete-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-searchable-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-rollback-1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - function_1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-3-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - auth_7-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - function_5-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - import_auth_3-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - migration-api-connection-migration2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-function-2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - datastore-modelgen-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - containers-api-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-key-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - function_2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-4-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-rollback-2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - auth_8-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - function_6-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - import_dynamodb_2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - migration-node-function-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-locking-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - amplify-configure-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
                - windows
      - schema-predictions-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - predictions-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - geo-remove-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - auth_1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - auth_3-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - api_3-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - env-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - function_4-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - api_1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - configure-project-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
                - windows
      - function_7-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - import_s3_2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - pull-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - storage-1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - init-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - amplify-app-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - hostingPROD-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - auth_5-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - migration-api-key-migration1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - import_auth_1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - auth_2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-model-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-5-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - container-hosting-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
                - windows
      - function_8-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - layer-1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - s3-sse-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - storage-2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - tags-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - hosting-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - function_3-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - auth_4-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - import_auth_2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-9-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - migration-api-connection-migration-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - api_2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - custom_policies_container-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - function_9-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - layer-2-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-12-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - storage-3-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - notifications-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - analytics-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-iterative-update-1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-7-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - import_s3_1-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-auth-11-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - schema-connection-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - api_5-amplify_e2e_tests_pkg:
          context:
            - amplify-ecr-image-pull
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build_pkg_binaries
          matrix:
            parameters:
              os:
                - linux
      - ConnectionsWithAuthTests-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - KeyTransformerLocal-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - MutationCondition-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - PredictionsTransformerTests-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - VersionedModelTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - CustomRoots-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - KeyWithAuth-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - NestedStacksTest-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - RelationalTransformers-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - DynamoDBModelTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - ModelAuthTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - NewConnectionTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - SearchableModelTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - FunctionTransformerTests-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - ModelConnectionTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - NewConnectionWithAuth-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - SearchableModelTransformerV2-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - HttpTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - ModelConnectionWithKeyTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - NoneEnvFunctionTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - SearchableWithAuthTests-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - IndexTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - ModelTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - NonModelAuthFunction-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - SubscriptionsWithAuthTest-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - KeyTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - MultiAuthModelAuthTransformer-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - PerFieldAuthTests-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - TestComplexStackMappingsLocal-e2e-graphql_e2e_tests:
          context:
            - amplify-ecr-image-pull
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-auth-deployment-migration-auth-deployment-secrets-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - update_tests-function_migration_update-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-lambda-layer-migration-layer-migration-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - update_tests-storage_migration_update-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-transformer_migration-api-key-migration-2-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-transformer_migration-api-key-migration-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-transformer_migration-api-searchable-migration-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - update_tests-api_migration_update-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - update_tests-auth_migration_update-amplify_migration_tests_v4:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-auth-deployment-migration-auth-deployment-secrets-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - update_tests-function_migration_update-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-lambda-layer-migration-layer-migration-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - update_tests-storage_migration_update-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-transformer_migration-api-key-migration-2-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-transformer_migration-api-key-migration-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - migration_tests-transformer_migration-api-searchable-migration-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - update_tests-api_migration_update-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
      - update_tests-auth_migration_update-amplify_migration_tests_latest:
          context:
            - amplify-ecr-image-pull
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - master
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
          matrix:
            parameters:
              os:
                - linux
commands:
  install_packaged_cli:
    description: Install Amplify Packaged CLI to PATH
    parameters:
      os:
        type: executor
        default: linux-e2e-executor
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.large
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - run:
                shell: powershell.exe
                name: Rename the Packaged CLI to amplify
                command: |
                  # rename the command to amplify
                  cd /home/circleci/repo/out
                  cp amplify-pkg-win.exe amplify.exe
            - run:
                shell: powershell.exe
                name: Move to CLI Binary to already existing PATH
                command: >
                  # This is a Hack to make sure the Amplify CLI is in the PATH

                  cp /home/circleci/repo/out/amplify.exe
                  $env:homedrive\$env:homepath\AppData\Local\Microsoft\WindowsApps
            - run:
                name: Confirm Amplify CLI is installed and available in PATH
                command: amplify version
      - when:
          condition:
            equal:
              - docker:
                  - image: >-
                      public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
                working_directory: ~/repo
                resource_class: large
                environment:
                  AMPLIFY_DIR: /home/circleci/repo/out
                  AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
              - << parameters.os >>
          steps:
            - run:
                name: Symlink Amplify packaged CLI
                command: |
                  cd out
                  ln -sf amplify-pkg-linux amplify
                  echo "export PATH=$AMPLIFY_DIR:$PATH" >> $BASH_ENV
                  source $BASH_ENV
            - run:
                name: Confirm Amplify CLI is installed and available in PATH
                command: amplify version
  install_yarn:
    description: Install Amplify Packaged CLI to PATH
    parameters:
      os:
        type: executor
        default: linux-e2e-executor
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.large
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - run: nvm install 12.22.5
            - run: nvm use 12.22.5
            - run: npm install -g yarn
            - run: yarn --cache-folder ~/.cache/yarn
            - run:
                shell: powershell.exe
                command: >-
                  cp /home/circleci/repo/out/amplify-pkg-win.exe
                  $env:homedrive\$env:homepath\AppData\Local\Microsoft\WindowsApps\amplify.exe
  install_java:
    description: Install Java on Linux and Docker images
    parameters:
      os:
        type: executor
        default: linux-e2e-executor
    steps:
      - when:
          condition:
            equal:
              - docker:
                  - image: >-
                      public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
                working_directory: ~/repo
                resource_class: large
                environment:
                  AMPLIFY_DIR: /home/circleci/repo/out
                  AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
              - << parameters.os >>
          steps:
            - run:
                name: Install Java
                command: |
                  sudo apt-get update && sudo apt-get install default-jdk
  run_e2e_tests:
    description: Run Amplify E2E tests
    parameters:
      os:
        type: executor
        default: linux-e2e-executor
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.large
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - run:
                name: Run E2e Tests
                shell: powershell.exe
                command: >
                  cd packages/amplify-e2e-tests

                  yarn run e2e --detectOpenHandles --maxWorkers=3
                  $env:TEST_SUITE
                no_output_timeout: 90m
      - when:
          condition:
            equal:
              - docker:
                  - image: >-
                      public.ecr.aws/a6e6w2n0/amplify-cli-e2e-base-image-repo-public:latest
                working_directory: ~/repo
                resource_class: large
                environment:
                  AMPLIFY_DIR: /home/circleci/repo/out
                  AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux
              - << parameters.os >>
          steps:
            - run:
                name: Run E2e Tests
                command: |
                  source .circleci/local_publish_helpers.sh
                  source $BASH_ENV
                  amplify version
                  retry runE2eTest
                no_output_timeout: 90m
  scan_e2e_test_artifacts:
    description: Scan And Cleanup E2E Test Artifacts
    parameters:
      os:
        type: executor
        default: linux-e2e-executor
    steps:
      - run:
          name: Scan E2E artifacts
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
  clean_e2e_resources:
    description: Cleanup resources
    parameters:
      os:
        type: executor
        default: linux-e2e-executor
    steps:
      - run:
          name: Clean job resources
          command: |
            pwd
            cd packages/amplify-e2e-tests
            yarn clean-e2e-resources job ${CIRCLE_BUILD_NUM}
          when: always
