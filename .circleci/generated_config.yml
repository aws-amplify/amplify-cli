# auto generated file. Edit config.base.yaml if you want to change
version: 2.1
orbs:
  aws-ecr: circleci/aws-ecr@6.15.3
machine:
  environment:
    PATH: ${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin
parameters:
  nightly_console_integration_tests:
    type: boolean
    default: false
  setup:
    type: boolean
    default: true
executors:
  w_medium:
    machine:
      image: windows-server-2019-vs2019:stable
      resource_class: windows.medium
      shell: bash.exe
    working_directory: ~/repo
    environment:
      AMPLIFY_DIR: C:/home/circleci/repo/out
      AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
  w_xlarge:
    machine:
      image: windows-server-2019-vs2019:stable
      resource_class: windows.xlarge
      shell: bash.exe
    working_directory: ~/repo
    environment:
      AMPLIFY_DIR: C:/home/circleci/repo/out
      AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
  l_xlarge:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: xlarge
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
  l_large:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
  l_medium:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: medium
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
  l_small:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: small
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
defaults:
  working_directory: ~/repo
  parameters:
    os:
      type: executor
      default: l_medium
  executor: << parameters.os >>
scan_e2e_test_artifacts:
  name: Scan And Cleanup E2E Test Artifacts
  no_output_timeout: 90m
  command: |
    if ! yarn ts-node .circleci/scan_artifacts.ts; then
      echo "Cleaning the repository"
      git clean -fdx
      exit 1
    fi
  when: always
install_cli_from_local_registry:
  name: Start verdaccio, install node CLI and amplify-app
  command: |
    source .circleci/local_publish_helpers.sh
    startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
    setNpmRegistryUrlToLocal
    changeNpmGlobalPath
    npm install -g @aws-amplify/cli
    npm install -g amplify-app
    unsetNpmRegistryUrl
jobs:
  build:
    parameters:
      os:
        type: executor
        default: l_xlarge
    executor: l_xlarge
    steps:
      - checkout
      - run: yarn config set registry https://registry.npmjs.org
      - run: yarn config set script-shell $(which bash)
      - run: yarn run production-build
      - run:
          name: Build tests
          command: yarn build-tests
      - save_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo
      - save_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
          paths:
            - ~/.cache
      - save_cache:
          key: amplify-cli-ssh-deps-{{ .Branch }}
          paths:
            - ~/.ssh
  build_tests_standalone:
    parameters:
      os:
        type: executor
        default: l_xlarge
    executor: l_xlarge
    steps:
      - checkout
      - run: yarn config set registry https://registry.npmjs.org
      - run: yarn config set script-shell $(which bash)
      - run: yarn install --network-concurrency 1
      - run:
          name: Build tests
          command: yarn build-tests
  build_windows_workspace_for_e2e:
    parameters:
      os:
        type: executor
        default: w_xlarge
    executor: w_xlarge
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.xlarge
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - checkout
            - run: yarn config set script-shell $(which bash)
            - run: yarn run production-build
            - run:
                name: Build tests
                command: yarn build-tests
            - persist_to_workspace:
                root: ~/.
                paths:
                  - repo
                  - .cache
                  - .ssh
  test:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: xlarge
    environment:
      NODE_OPTIONS: '--max-old-space-size=4096'
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: Run tests
          command: yarn test-ci
      - run:
          name: Collect code coverage
          command: yarn coverage
  validate_cdk_version:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: medium
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: Validate cdk version
          command: |
            yarn ts-node .circleci/validate_cdk_version.ts
  lint:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run: yarn lint-check
      - run: yarn lint-check-package-json
      - run: yarn prettier-check
  verify-api-extract:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: xlarge
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: extract api
          command: |
            yarn verify-api-extract
  verify-yarn-lock:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: medium
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: verify yarn lock
          command: |
            yarn verify-yarn-lock
  verify-versions-match:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: medium
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: verify versions match
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            checkPackageVersionsInLocalNpmRegistry
  mock_e2e_tests:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: Run Transformer end-to-end tests with mock server
          command: |
            source .circleci/local_publish_helpers.sh
            cd packages/amplify-util-mock/
            yarn e2e
          no_output_timeout: 90m
          environment:
            JEST_JUNIT_OUTPUT: reports/junit/js-test-results.xml
            NODE_OPTIONS: '--max-old-space-size=4096'
      - store_test_results:
          path: ~/repo/packages/amplify-util-mock/
  publish_to_local_registry:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: Publish to verdaccio
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            export LOCAL_PUBLISH_TO_LATEST=true
            ./.circleci/publish.sh
            unsetNpmRegistryUrl
      - run:
          name: Generate unified changelog
          command: |
            git reset --soft HEAD~1
            yarn ts-node scripts/unified-changelog.ts
            cat UNIFIED_CHANGELOG.md
      - run:
          name: Save new amplify GitHub tag
          command: node scripts/echo-current-cli-version.js > .amplify-pkg-version
      - save_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/verdaccio-cache/
      - save_cache:
          key: amplify-unified-changelog-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/UNIFIED_CHANGELOG.md
      - save_cache:
          key: amplfiy-pkg-tag-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/.amplify-pkg-version
  upload_pkg_binaries:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-linux-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-macos-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-win-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-arm-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Consolidate binaries cache and upload
          command: |
            source .circleci/local_publish_helpers.sh
            uploadPkgCli
      - save_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/out
  build_pkg_binaries_linux:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio and package CLI
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            generatePkgCli linux
            unsetNpmRegistryUrl
      - save_cache:
          key: amplify-pkg-binaries-linux-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/out
  build_pkg_binaries_macos:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio and package CLI
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            generatePkgCli macos
            unsetNpmRegistryUrl
      - save_cache:
          key: amplify-pkg-binaries-macos-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/out
  build_pkg_binaries_win:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio and package CLI
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            generatePkgCli win
            unsetNpmRegistryUrl
      - save_cache:
          key: amplify-pkg-binaries-win-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/out
  build_pkg_binaries_arm:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio and package CLI
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            generatePkgCli arm
            unsetNpmRegistryUrl
      - save_cache:
          key: amplify-pkg-binaries-arm-{{ .Branch }}-{{ .Revision }}
          paths:
            - ~/repo/out
  verify_pkg_binaries:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-linux-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-macos-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-win-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-arm-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Verify packaged CLI
          command: |
            source .circleci/local_publish_helpers.sh
            verifyPkgCli
  amplify_sudo_install_test:
    working_directory: ~/repo
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Update OS Packages
          command: sudo apt-get update
      - run:
          name: Start verdaccio and Install Amplify CLI as sudo
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setSudoNpmRegistryUrlToLocal
            changeSudoNpmGlobalPath
            sudo npm install -g @aws-amplify/cli
            unsetSudoNpmRegistryUrl
            amplify version
  amplify_e2e_tests_pkg:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
  amplify_migration_tests_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  amplify_migration_tests_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  amplify_migration_tests_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  amplify_migration_tests_non_multi_env_layers:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: Run tests migrating from CLI v4.28.2
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v4.28.2_nonmultienv_layers --no-cache
            --maxWorkers=4 --forceExit $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  amplify_migration_tests_multi_env_layers:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v4.52.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v4.52.0_multienv_layers --no-cache
            --maxWorkers=4 --forceExit $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  amplify_general_config_tests:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests using general profile
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-e2e-tests

            retry yarn run general-config-e2e --no-cache --maxWorkers=3
            --forceExit $TEST_SUITE
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    working_directory: ~/repo
  amplify_console_integration_tests:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Start verdaccio, install node CLI and amplify-app
          command: |
            source .circleci/local_publish_helpers.sh
            startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
            setNpmRegistryUrlToLocal
            changeNpmGlobalPath
            npm install -g @aws-amplify/cli
            npm install -g amplify-app
            unsetNpmRegistryUrl
      - run:
          command: |
            echo "export PATH=~/.npm-global/bin:$PATH" >> $BASH_ENV
            source $BASH_ENV
            source .circleci/local_publish_helpers.sh
            amplify -v
            cd packages/amplify-console-integration-tests
            retry yarn run console-integration --no-cache --maxWorkers=4
          name: Run Amplify Console integration tests
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-console-integration-tests/
      - store_artifacts:
          path: >-
            ~/repo/packages/amplify-console-integration-tests/console-integration-reports
    working_directory: ~/repo
  integration_test:
    working_directory: /home/circleci/repo
    resource_class: large
    docker:
      - image: cypress/base:14.17.0
        environment:
          TERM: dumb
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - run: cd .circleci/ && chmod +x aws.sh
      - run:
          name: Setup Dependencies
          command: |
            apt-get update
            apt-get install -y sudo
            sudo apt-get install -y tcl
            sudo apt-get install -y expect
            sudo apt-get install -y zip
            sudo apt-get install -y lsof
            sudo apt-get install -y python python-pip libpython-dev
            sudo apt-get install -y jq
            pip install awscli
      - run: expect .circleci/aws_configure.exp
      - run:
          name: Configure Amplify CLI
          command: >
            yarn rm-dev-link && yarn link-dev && yarn rm-aa-dev-link && yarn
            link-aa-dev

            echo 'export PATH="$(yarn global bin):$PATH"' >> $BASH_ENV

            amplify-dev
      - run:
          name: Clone auth test package
          command: |
            cd ..
            git clone $AUTH_CLONE_URL
            cd aws-amplify-cypress-auth
            yarn --cache-folder ~/.cache/yarn
            yarn add cypress@6.8.0 --save
      - run: cd .circleci/ && chmod +x auth.sh
      - run: cd .circleci/ && chmod +x amplify_init.sh
      - run: cd .circleci/ && chmod +x amplify_init.exp
      - run: expect .circleci/amplify_init.exp ../aws-amplify-cypress-auth
      - run: expect .circleci/enable_auth.exp
      - run: cd ../aws-amplify-cypress-auth
      - run: yarn --frozen-lockfile --cache-folder ~/.cache/yarn
      - run: >-
          cd ../aws-amplify-cypress-auth/src && cat $(find . -type f -name
          'aws-exports*')
      - run:
          name: Start Auth test server in background
          command: |
            cd ../aws-amplify-cypress-auth
            pwd
            yarn start
          background: true
      - run: cat $(find ../repo -type f -name 'auth_spec*')
      - run:
          name: Run cypress tests for auth
          command: |
            cd ../aws-amplify-cypress-auth
            cp ../repo/cypress.json .
            cp -R ../repo/cypress .
            yarn cypress run --spec $(find . -type f -name 'auth_spec*')
      - run: sudo kill -9 $(lsof -t -i:3000)
      - run: cd .circleci/ && chmod +x delete_auth.sh
      - run: expect .circleci/delete_auth.exp
      - run:
          name: Clone API test package
          command: |
            cd ..
            git clone $API_CLONE_URL
            cd aws-amplify-cypress-api
            yarn --cache-folder ~/.cache/yarn
      - run: cd .circleci/ && chmod +x api.sh
      - run: expect .circleci/amplify_init.exp ../aws-amplify-cypress-api
      - run: expect .circleci/enable_api.exp
      - run: cd ../aws-amplify-cypress-api
      - run: yarn --frozen-lockfile --cache-folder ~/.cache/yarn
      - run: >-
          cd ../aws-amplify-cypress-api/src && cat $(find . -type f -name
          'aws-exports*')
      - run:
          name: Start API test server in background
          command: |
            cd ../aws-amplify-cypress-api
            pwd
            yarn start
          background: true
      - run:
          name: Run cypress tests for api
          command: |
            cd ../aws-amplify-cypress-api
            yarn add cypress@6.8.0 --save
            cp ../repo/cypress.json .
            cp -R ../repo/cypress .
            yarn cypress run --spec $(find . -type f -name 'api_spec*')
      - run: cd .circleci/ && chmod +x delete_api.sh
      - run: expect .circleci/delete_api.exp
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_artifacts:
          path: ~/aws-amplify-cypress-auth/cypress/videos
      - store_artifacts:
          path: ~/aws-amplify-cypress-auth/cypress/screenshots
      - store_artifacts:
          path: ~/aws-amplify-cypress-api/cypress/videos
      - store_artifacts:
          path: ~/aws-amplify-cypress-api/cypress/screenshots
  deploy:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          keys:
            - amplify-cli-ssh-deps-{{ .Branch }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Upload Pkg Binary
          command: |
            source .circleci/local_publish_helpers.sh
            uploadPkgCli
            ./out/amplify-pkg-linux-x64 --version
      - run:
          name: Authenticate with npm
          command: echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > ~/.npmrc
      - run:
          name: Publish Amplify CLI
          command: |
            bash ./.circleci/publish.sh
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
  github_prerelease:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-unified-changelog-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplfiy-pkg-tag-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Compress binaries
          command: |
            cd out
            mv amplify-pkg-macos-x64 amplify-pkg-macos
            mv amplify-pkg-linux-x64 amplify-pkg-linux
            mv amplify-pkg-win-x64.exe amplify-pkg-win.exe
            tar zcvf amplify-pkg-macos.tgz amplify-pkg-macos
            tar zcvf amplify-pkg-linux.tgz amplify-pkg-linux
            tar zcvf amplify-pkg-win.exe.tgz amplify-pkg-win.exe
      - run:
          name: Publish Amplify CLI GitHub prerelease
          command: |
            commit=$(git rev-parse HEAD)
            version=$(cat .amplify-pkg-version)
            yarn ts-node scripts/github-prerelease.ts $version $commit
  github_prerelease_install_sanity_check:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplfiy-pkg-tag-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Install packaged Amplify CLI
          command: >
            version=$(cat .amplify-pkg-version)

            curl -sL https://aws-amplify.github.io/amplify-cli/install |
            version=v$version bash

            echo "export PATH=$PATH:$HOME/.amplify/bin" >> $BASH_ENV
      - run:
          name: Sanity check install
          command: |
            amplify version
  github_release:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplfiy-pkg-tag-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Publish Amplify CLI GitHub release
          command: |
            commit=$(git rev-parse HEAD)
            version=$(cat .amplify-pkg-version)
            yarn ts-node scripts/github-release.ts $version $commit
  cleanup_resources:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: large
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: Run cleanup script
          command: |
            cd packages/amplify-e2e-tests
            yarn clean-e2e-resources
          no_output_timeout: 90m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
  trigger_e2e_workflow_cleanup:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: medium
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - run:
          name: Trigger Cleanup for this Workflow
          command: |
            echo "Triggering cleanup for Workflow $CIRCLE_WORKFLOW_ID"
            curl --request POST \
              --url https://circleci.com/api/v2/project/gh/aws-amplify/amplify-cli/pipeline \
              --header "Circle-Token: $AMPLIFY_CLI_CIRCLECI_TRIGGER_TOKEN" \
              --header "content-type: application/json" \
              --data '{"branch":"'$CIRCLE_BRANCH'","parameters":{"e2e_workflow_cleanup":true,"setup":false,"e2e_workflow_cleanup_workflow_id":"'$CIRCLE_WORKFLOW_ID'"}}'
  wait_for_all:
    docker:
      - image: public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
    working_directory: ~/repo
    resource_class: small
    environment:
      AMPLIFY_DIR: /home/circleci/repo/out
      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - run:
          name: Wait for all required jobs to finish
          command: >
            while [[ $(curl --location --request GET
            "https://circleci.com/api/v2/workflow/$CIRCLE_WORKFLOW_ID/job"
            --header "Circle-Token: $CIRCLECI_TOKEN"| jq -r
            '.items[]|select(.name != "wait_for_all")|.status' | grep -c
            "running") -gt 0 ]]
              do
                sleep 60
              done
          no_output_timeout: 180m
      - run:
          name: Collect Results
          command: yarn workflow-results
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_artifacts:
          path: ~/repo/artifacts
  l_datastore-modelgen_amplify-app_diagnose_hooks-a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/datastore-modelgen.test.ts|src/__tests__/amplify-app.test.ts|src/__tests__/diagnose.test.ts|src/__tests__/hooks-a.test.ts
      CLI_REGION: us-east-2
  l_mock-api_analytics-kinesis_analytics-pinpoint-flutter_analytics-pinpoint-js:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/mock-api.test.ts|src/__tests__/analytics-kinesis.test.ts|src/__tests__/analytics-pinpoint-flutter.test.ts|src/__tests__/analytics-pinpoint-js.test.ts
      CLI_REGION: ap-southeast-1
  l_auth_2a_auth_2b_auth_2d_auth_2f:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_2a.test.ts|src/__tests__/auth_2b.test.ts|src/__tests__/auth_2d.test.ts|src/__tests__/auth_2f.test.ts
      CLI_REGION: ap-northeast-1
  l_notifications-lifecycle_uibuilder_notifications-analytics-compatibility-in-app-1_notifications-analytics-compatibility-sms-2:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/notifications-lifecycle.test.ts|src/__tests__/uibuilder.test.ts|src/__tests__/notifications-analytics-compatibility-in-app-1.test.ts|src/__tests__/notifications-analytics-compatibility-sms-2.test.ts
      CLI_REGION: us-west-2
  l_analytics-2_global_sandbox-c_hooks-b_notifications-analytics-compatibility-sms-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/analytics-2.test.ts|src/__tests__/global_sandbox-c.test.ts|src/__tests__/hooks-b.test.ts|src/__tests__/notifications-analytics-compatibility-sms-1.test.ts
      CLI_REGION: ap-southeast-2
  l_plugin_studio-modelgen_custom-transformers_notifications-in-app-messaging-env-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/plugin.test.ts|src/__tests__/studio-modelgen.test.ts|src/__tests__/graphql-v2/custom-transformers.test.ts|src/__tests__/notifications-in-app-messaging-env-1.test.ts
      CLI_REGION: eu-west-2
  l_notifications-sms-pull_pull_auth_10_container-hosting:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/notifications-sms-pull.test.ts|src/__tests__/pull.test.ts|src/__tests__/auth_10.test.ts|src/__tests__/container-hosting.test.ts
      CLI_REGION: ap-southeast-1
  l_init_b_notifications-apns_notifications-fcm_notifications-in-app-messaging-env-2:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/init_b.test.ts|src/__tests__/notifications-apns.test.ts|src/__tests__/notifications-fcm.test.ts|src/__tests__/notifications-in-app-messaging-env-2.test.ts
      CLI_REGION: ap-southeast-2
  l_with-babel-config_amplify-configure_env-2_init_d:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/with-babel-config.test.ts|src/__tests__/amplify-configure.test.ts|src/__tests__/env-2.test.ts|src/__tests__/init_d.test.ts
      CLI_REGION: eu-central-1
  l_init_f_auth_5d_configure-project_git-clone-attach:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/init_f.test.ts|src/__tests__/auth_5d.test.ts|src/__tests__/configure-project.test.ts|src/__tests__/git-clone-attach.test.ts
      CLI_REGION: us-east-1
  l_init_c_layer-4_function_2c_function_3b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/init_c.test.ts|src/__tests__/layer-4.test.ts|src/__tests__/function_2c.test.ts|src/__tests__/function_3b.test.ts
      CLI_REGION: us-east-1
  l_function_4_interactions_schema-model-a_tags:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/function_4.test.ts|src/__tests__/interactions.test.ts|src/__tests__/schema-model-a.test.ts|src/__tests__/tags.test.ts
      CLI_REGION: us-west-2
  l_auth_1a_auth-trigger_custom_policies_function_function_6:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_1a.test.ts|src/__tests__/auth-trigger.test.ts|src/__tests__/custom_policies_function.test.ts|src/__tests__/function_6.test.ts
      CLI_REGION: ap-northeast-1
  l_storage-2_export_iam-permissions-boundary_node-function:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/storage-2.test.ts|src/__tests__/export.test.ts|src/__tests__/iam-permissions-boundary.test.ts|src/__tests__/migration/node.function.test.ts
      CLI_REGION: us-east-2
  l_notifications-sms_schema-auth-4b_schema-model-e_schema-versioned:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/notifications-sms.test.ts|src/__tests__/schema-auth-4b.test.ts|src/__tests__/schema-model-e.test.ts|src/__tests__/schema-versioned.test.ts
      CLI_REGION: ap-southeast-1
  l_auth_1c_auth_5e_auth_8b_geo-add-b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_1c.test.ts|src/__tests__/auth_5e.test.ts|src/__tests__/auth_8b.test.ts|src/__tests__/geo-add-b.test.ts
      CLI_REGION: eu-central-1
  l_s3-sse_schema-auth-4a_schema-model-b_schema-model-d:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/s3-sse.test.ts|src/__tests__/schema-auth-4a.test.ts|src/__tests__/schema-model-b.test.ts|src/__tests__/schema-model-d.test.ts
      CLI_REGION: us-east-1
  l_auth_5f_env-4_frontend_config_drift_schema-auth-4d:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_5f.test.ts|src/__tests__/env-4.test.ts|src/__tests__/frontend_config_drift.test.ts|src/__tests__/schema-auth-4d.test.ts
      CLI_REGION: ap-southeast-1
  l_schema-auth-6a_schema-data-access-patterns_schema-model-c_schema-predictions:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-6a.test.ts|src/__tests__/schema-data-access-patterns.test.ts|src/__tests__/schema-model-c.test.ts|src/__tests__/schema-predictions.test.ts
      CLI_REGION: us-west-2
  l_model-migration_auth_3c_auth_4c_auth_5a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/transformer-migrations/model-migration.test.ts|src/__tests__/auth_3c.test.ts|src/__tests__/auth_4c.test.ts|src/__tests__/auth_5a.test.ts
      CLI_REGION: us-west-2
  l_auth_5c_env-1_geo-add-a_init_a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_5c.test.ts|src/__tests__/env-1.test.ts|src/__tests__/geo-add-a.test.ts|src/__tests__/init_a.test.ts
      CLI_REGION: eu-west-2
  l_schema-auth-4c_schema-auth-5c_auth_5b_auth_9:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-4c.test.ts|src/__tests__/schema-auth-5c.test.ts|src/__tests__/auth_5b.test.ts|src/__tests__/auth_9.test.ts
      CLI_REGION: us-east-2
  l_custom_resources_env-5_function_10_function_9c:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/custom_resources.test.ts|src/__tests__/env-5.test.ts|src/__tests__/function_10.test.ts|src/__tests__/function_9c.test.ts
      CLI_REGION: ap-southeast-2
  l_function-permissions_geo-import-1a_geo-import-2_global_sandbox-b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/function-permissions.test.ts|src/__tests__/geo-import-1a.test.ts|src/__tests__/geo-import-2.test.ts|src/__tests__/global_sandbox-b.test.ts
      CLI_REGION: ap-southeast-2
  l_schema-auth-5d_schema-auth-6b_schema-auth-8c_auth_3a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-5d.test.ts|src/__tests__/schema-auth-6b.test.ts|src/__tests__/schema-auth-8c.test.ts|src/__tests__/auth_3a.test.ts
      CLI_REGION: eu-west-2
  l_auth_3b_auth_4a_auth_7a_auth_8c:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_3b.test.ts|src/__tests__/auth_4a.test.ts|src/__tests__/auth_7a.test.ts|src/__tests__/auth_8c.test.ts
      CLI_REGION: ap-northeast-1
  l_feature-flags_geo-import-1b_global_sandbox-a_init_e:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/feature-flags.test.ts|src/__tests__/geo-import-1b.test.ts|src/__tests__/global_sandbox-a.test.ts|src/__tests__/init_e.test.ts
      CLI_REGION: ap-northeast-1
  l_notifications-analytics-compatibility-in-app-2_schema-auth-11-c_schema-auth-2b_schema-auth-6c:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/notifications-analytics-compatibility-in-app-2.test.ts|src/__tests__/schema-auth-11-c.test.ts|src/__tests__/schema-auth-2b.test.ts|src/__tests__/schema-auth-6c.test.ts
      CLI_REGION: ap-southeast-2
  l_schema-auth-6d_schema-auth-7c_schema-auth-8a_function-migration:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-6d.test.ts|src/__tests__/schema-auth-7c.test.ts|src/__tests__/schema-auth-8a.test.ts|src/__tests__/transformer-migrations/function-migration.test.ts
      CLI_REGION: eu-central-1
  l_api_10_api_7_export-pull-a_function_9a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/api_10.test.ts|src/__tests__/api_7.test.ts|src/__tests__/export-pull-a.test.ts|src/__tests__/function_9a.test.ts
      CLI_REGION: ap-southeast-2
  l_geo-headless_api-key-migration5_schema-auth-1a_schema-auth-5b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/geo-headless.test.ts|src/__tests__/migration/api.key.migration5.test.ts|src/__tests__/schema-auth-1a.test.ts|src/__tests__/schema-auth-5b.test.ts
      CLI_REGION: ap-southeast-2
  l_schema-auth-8b_schema-auth-9-a_schema-auth-9-c_storage-3:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-8b.test.ts|src/__tests__/schema-auth-9-a.test.ts|src/__tests__/schema-auth-9-c.test.ts|src/__tests__/storage-3.test.ts
      CLI_REGION: us-east-1
  l_auth_11_auth_1b_delete_geo-add-c:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_11.test.ts|src/__tests__/auth_1b.test.ts|src/__tests__/delete.test.ts|src/__tests__/geo-add-c.test.ts
      CLI_REGION: ap-southeast-2
  l_geo-add-d_geo-import-3_hosting_layer-3:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/geo-add-d.test.ts|src/__tests__/geo-import-3.test.ts|src/__tests__/hosting.test.ts|src/__tests__/layer-3.test.ts
      CLI_REGION: ap-northeast-1
  l_api-connection-migration_api-key-migration3_predictions_schema-auth-11-b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/migration/api.connection.migration.test.ts|src/__tests__/migration/api.key.migration3.test.ts|src/__tests__/predictions.test.ts|src/__tests__/schema-auth-11-b.test.ts
      CLI_REGION: us-east-1
  l_schema-auth-1b_schema-auth-2a_schema-auth-7a_schema-auth-7b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-1b.test.ts|src/__tests__/schema-auth-2a.test.ts|src/__tests__/schema-auth-7a.test.ts|src/__tests__/schema-auth-7b.test.ts
      CLI_REGION: us-east-2
  l_schema-auth-9-b_schema-iterative-rollback-1_predictions-migration_api_6a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-9-b.test.ts|src/__tests__/schema-iterative-rollback-1.test.ts|src/__tests__/transformer-migrations/predictions-migration.test.ts|src/__tests__/api_6a.test.ts
      CLI_REGION: ap-northeast-1
  l_auth_7b_export-pull-b_function_3a_init-special-case:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_7b.test.ts|src/__tests__/export-pull-b.test.ts|src/__tests__/function_3a.test.ts|src/__tests__/init-special-case.test.ts
      CLI_REGION: ap-southeast-1
  l_http-migration_schema-auth-12_schema-auth-3_schema-function-2:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/transformer-migrations/http-migration.test.ts|src/__tests__/schema-auth-12.test.ts|src/__tests__/schema-auth-3.test.ts|src/__tests__/schema-function-2.test.ts
      CLI_REGION: ap-northeast-1
  l_auth_4b_auth_8a_export-pull-d_schema-auth-5a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/auth_4b.test.ts|src/__tests__/auth_8a.test.ts|src/__tests__/export-pull-d.test.ts|src/__tests__/schema-auth-5a.test.ts
      CLI_REGION: ap-northeast-1
  l_schema-iterative-rollback-2_schema-iterative-update-3_auth-migration_api_2a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-iterative-rollback-2.test.ts|src/__tests__/schema-iterative-update-3.test.ts|src/__tests__/transformer-migrations/auth-migration.test.ts|src/__tests__/api_2a.test.ts
      CLI_REGION: eu-west-2
  l_api_2b_api_6c_api_9a_auth_12:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/api_2b.test.ts|src/__tests__/api_6c.test.ts|src/__tests__/api_9a.test.ts|src/__tests__/auth_12.test.ts
      CLI_REGION: ap-southeast-1
  l_custom-resource-with-storage_dynamodb-simulator_export-pull-c_general-config-headless-init:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/custom-resource-with-storage.test.ts|src/__tests__/dynamodb-simulator/dynamodb-simulator.test.ts|src/__tests__/export-pull-c.test.ts|src/__tests__/general-config/general-config-headless-init.test.ts
      CLI_REGION: us-west-2
  l_help_init-force-push_interactions-1_interactions-2:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/help.test.ts|src/__tests__/init-force-push.test.ts|src/__tests__/interactions-1.test.ts|src/__tests__/interactions-2.test.ts
      CLI_REGION: us-west-2
  l_minify-cloudformation_notifications-multi-env_opensearch-simulator_parameter-store-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/minify-cloudformation.test.ts|src/__tests__/notifications-multi-env.test.ts|src/__tests__/opensearch-simulator/opensearch-simulator.test.ts|src/__tests__/parameter-store-1.test.ts
      CLI_REGION: eu-central-1
  l_parameter-store-2_android-analytics-pinpoint-config_android-notifications-pinpoint-config_flutter-analytics-pinpoint-config:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/parameter-store-2.test.ts|src/__tests__/pinpoint/android-analytics-pinpoint-config.test.ts|src/__tests__/pinpoint/android-notifications-pinpoint-config.test.ts|src/__tests__/pinpoint/flutter-analytics-pinpoint-config.test.ts
      CLI_REGION: ap-southeast-1
  l_flutter-notifications-pinpoint-config_ios-analytics-pinpoint-config_ios-notifications-pinpoint-config_javascript-analytics-pinpoint-config:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/pinpoint/flutter-notifications-pinpoint-config.test.ts|src/__tests__/pinpoint/ios-analytics-pinpoint-config.test.ts|src/__tests__/pinpoint/ios-notifications-pinpoint-config.test.ts|src/__tests__/pinpoint/javascript-analytics-pinpoint-config.test.ts
      CLI_REGION: ap-northeast-1
  l_javascript-notifications-pinpoint-config_push_S3server_api_8:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/pinpoint/javascript-notifications-pinpoint-config.test.ts|src/__tests__/push.test.ts|src/__tests__/storage-simulator/S3server.test.ts|src/__tests__/api_8.test.ts
      CLI_REGION: us-west-2
  l_function_8_schema-iterative-update-locking_api_lambda_auth_2_layer-2:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/function_8.test.ts|src/__tests__/schema-iterative-update-locking.test.ts|src/__tests__/graphql-v2/api_lambda_auth_2.test.ts|src/__tests__/layer-2.test.ts
      CLI_REGION: us-west-2
  l_schema-auth-13_function_5_schema-iterative-update-1_auth_6:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-13.test.ts|src/__tests__/function_5.test.ts|src/__tests__/schema-iterative-update-1.test.ts|src/__tests__/auth_6.test.ts
      CLI_REGION: ap-northeast-1
  l_function_2a_schema-connection-2_schema-function-1_api_9b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/function_2a.test.ts|src/__tests__/schema-connection-2.test.ts|src/__tests__/schema-function-1.test.ts|src/__tests__/api_9b.test.ts
      CLI_REGION: eu-central-1
  l_custom_policies_container_function_9b_schema-iterative-update-2_storage-1a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/custom_policies_container.test.ts|src/__tests__/function_9b.test.ts|src/__tests__/schema-iterative-update-2.test.ts|src/__tests__/storage-1a.test.ts
      CLI_REGION: us-east-1
  l_storage-1b_function_11_function_2b_function_7:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/storage-1b.test.ts|src/__tests__/function_11.test.ts|src/__tests__/function_2b.test.ts|src/__tests__/function_7.test.ts
      CLI_REGION: eu-central-1
  l_api-connection-migration2_api_4_containers-api-secrets_storage-4:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/migration/api.connection.migration2.test.ts|src/__tests__/api_4.test.ts|src/__tests__/containers-api-secrets.test.ts|src/__tests__/storage-4.test.ts
      CLI_REGION: ap-southeast-1
  l_schema-auth-10_geo-multi-env_searchable-datastore_resolvers:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-10.test.ts|src/__tests__/geo-multi-env.test.ts|src/__tests__/graphql-v2/searchable-datastore.test.ts|src/__tests__/resolvers.test.ts
      CLI_REGION: eu-central-1
  l_schema-key_api_5_apigw_api_lambda_auth_1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-key.test.ts|src/__tests__/api_5.test.ts|src/__tests__/apigw.test.ts|src/__tests__/graphql-v2/api_lambda_auth_1.test.ts
      CLI_REGION: ap-southeast-1
  l_api-key-migration2_schema-searchable_api-key-migration1_schema-auth-14:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/migration/api.key.migration2.test.ts|src/__tests__/schema-searchable.test.ts|src/__tests__/migration/api.key.migration1.test.ts|src/__tests__/schema-auth-14.test.ts
      CLI_REGION: ap-southeast-1
  l_api_3_api_6b_api_1_layer-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/api_3.test.ts|src/__tests__/api_6b.test.ts|src/__tests__/api_1.test.ts|src/__tests__/layer-1.test.ts
      CLI_REGION: ap-southeast-1
  l_api-key-migration4_schema-iterative-update-4_function_1_storage-5:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/migration/api.key.migration4.test.ts|src/__tests__/schema-iterative-update-4.test.ts|src/__tests__/function_1.test.ts|src/__tests__/storage-5.test.ts
      CLI_REGION: us-east-2
  l_auth_2c:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_2c.test.ts
      CLI_REGION: ap-southeast-1
  l_auth_2e:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_2e.test.ts
      CLI_REGION: us-east-2
  l_geo-remove-3:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-remove-3.test.ts
      CLI_REGION: us-east-1
  l_geo-add-f:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-add-f.test.ts
      CLI_REGION: us-east-1
  l_geo-add-e:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-add-e.test.ts
      CLI_REGION: eu-west-2
  l_import_dynamodb_2c:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_dynamodb_2c.test.ts
      CLI_REGION: eu-west-2
  l_env-3:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/env-3.test.ts
      CLI_REGION: ap-southeast-2
  l_geo-remove-2:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-remove-2.test.ts
      CLI_REGION: eu-central-1
  l_notifications-in-app-messaging:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/notifications-in-app-messaging.test.ts
      CLI_REGION: ap-southeast-1
  l_import_auth_2a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_auth_2a.test.ts
      CLI_REGION: ap-northeast-1
  l_import_auth_1a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_auth_1a.test.ts
      CLI_REGION: us-east-1
  l_import_auth_2b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_auth_2b.test.ts
      CLI_REGION: eu-west-2
  l_import_s3_2a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_s3_2a.test.ts
      CLI_REGION: eu-central-1
  l_import_s3_2c:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_s3_2c.test.ts
      CLI_REGION: us-east-2
  l_import_auth_1b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_auth_1b.test.ts
      CLI_REGION: ap-northeast-1
  l_schema-auth-11-a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-11-a.test.ts
      CLI_REGION: us-east-2
  l_geo-update-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-update-1.test.ts
      CLI_REGION: us-east-2
  l_geo-update-2:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-update-2.test.ts
      CLI_REGION: ap-northeast-1
  l_import_s3_3:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_s3_3.test.ts
      CLI_REGION: ap-southeast-2
  l_import_dynamodb_2b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_dynamodb_2b.test.ts
      CLI_REGION: ap-southeast-2
  l_hostingPROD:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/hostingPROD.test.ts
      CLI_REGION: ap-northeast-1
  l_import_s3_2b:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_s3_2b.test.ts
      CLI_REGION: us-east-2
  l_containers-api-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/containers-api-1.test.ts
      CLI_REGION: ap-southeast-1
  l_schema-auth-15:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-auth-15.test.ts
      CLI_REGION: ap-northeast-1
  l_schema-connection-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/schema-connection-1.test.ts
      CLI_REGION: eu-west-2
  l_import_auth_3:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_auth_3.test.ts
      CLI_REGION: ap-southeast-2
  l_import_dynamodb_2a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_dynamodb_2a.test.ts
      CLI_REGION: ap-southeast-1
  l_containers-api-2:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/containers-api-2.test.ts
      CLI_REGION: us-west-2
  l_import_s3_1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_s3_1.test.ts
      CLI_REGION: eu-west-2
      USE_PARENT_ACCOUNT: 1
  l_searchable-migration:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/transformer-migrations/searchable-migration.test.ts
      CLI_REGION: ap-southeast-2
      USE_PARENT_ACCOUNT: 1
  l_geo-remove-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/geo-remove-1.test.ts
      CLI_REGION: eu-central-1
  l_import_dynamodb_1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/import_dynamodb_1.test.ts
      CLI_REGION: us-east-2
      USE_PARENT_ACCOUNT: 1
  w_hooks-b_interactions_auth-trigger_custom_policies_function:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/hooks-b.test.ts|src/__tests__/interactions.test.ts|src/__tests__/auth-trigger.test.ts|src/__tests__/custom_policies_function.test.ts
      CLI_REGION: us-west-2
  w_schema-model-e_auth_5e_auth_8b_auth_3c:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-model-e.test.ts|src/__tests__/auth_5e.test.ts|src/__tests__/auth_8b.test.ts|src/__tests__/auth_3c.test.ts
      CLI_REGION: eu-central-1
  w_env-1_geo-add-a_auth_5b_function_10:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/env-1.test.ts|src/__tests__/geo-add-a.test.ts|src/__tests__/auth_5b.test.ts|src/__tests__/function_10.test.ts
      CLI_REGION: us-east-2
  w_function-permissions_global_sandbox-b_feature-flags_export-pull-a:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/function-permissions.test.ts|src/__tests__/global_sandbox-b.test.ts|src/__tests__/feature-flags.test.ts|src/__tests__/export-pull-a.test.ts
      CLI_REGION: us-west-2
  w_schema-auth-1a_auth_11_auth_7b_parameter-store-1:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/schema-auth-1a.test.ts|src/__tests__/auth_11.test.ts|src/__tests__/auth_7b.test.ts|src/__tests__/parameter-store-1.test.ts
      CLI_REGION: ap-northeast-1
  w_parameter-store-2_schema-iterative-update-1_auth_6_containers-api-secrets:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: >-
        src/__tests__/parameter-store-2.test.ts|src/__tests__/schema-iterative-update-1.test.ts|src/__tests__/auth_6.test.ts|src/__tests__/containers-api-secrets.test.ts
      CLI_REGION: eu-central-1
  w_auth_2e:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/auth_2e.test.ts
      CLI_REGION: eu-central-1
  w_hostingPROD:
    parameters:
      os:
        type: executor
        default: l_medium
    executor: << parameters.os >>
    working_directory: ~/repo
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - install_node14_windows
            - attach_workspace:
                at: ~/.
            - run:
                name: Git enable long paths
                command: git config --global core.longpaths true
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - restore_cache:
                key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
            - restore_cache:
                key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-verdaccio-cache-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-build-artifact-{{ .Revision }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - rename_binary_for_windows:
          os: << parameters.os >>
      - install_packaged_cli:
          os: << parameters.os >>
      - run_e2e_tests:
          os: << parameters.os >>
      - scan_e2e_test_artifacts:
          os: << parameters.os >>
      - store_test_results:
          path: ~/repo/packages/amplify-e2e-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-e2e-tests/amplify-e2e-reports
    environment:
      TEST_SUITE: src/__tests__/hostingPROD.test.ts
      CLI_REGION: ap-southeast-1
  l_notifications-migration-4_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/notifications-migration/notifications-migration-4.test.ts
      CLI_REGION: eu-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-key-migration_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.key.migration.test.ts
      CLI_REGION: eu-central-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_notifications-migration_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/notifications-migration/notifications-migration.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-key-migration-2_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.key.migration-2.test.ts
      CLI_REGION: eu-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_notifications-migration-2_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/notifications-migration/notifications-migration-2.test.ts
      CLI_REGION: ap-southeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_function_migration_update_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/function_migration_update.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_storage_migration_update_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/storage_migration_update.test.ts
      CLI_REGION: ap-southeast-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth_migration_update_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/auth_migration_update.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_notifications-migration-3_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/notifications-migration/notifications-migration-3.test.ts
      CLI_REGION: ap-northeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api_migration_update_v5:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/api_migration_update.test.ts
      CLI_REGION: us-east-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v5.2.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v5.2.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth-migration-d_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/auth-migration-d.test.ts
      CLI_REGION: ap-northeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_init-migration_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/init-migration.test.ts
      CLI_REGION: eu-central-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_notifications-migration-4_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/notifications-migration/notifications-migration-4.test.ts
      CLI_REGION: us-east-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth-migration-e_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/auth-migration-e.test.ts
      CLI_REGION: ap-northeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-key-migration_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.key.migration.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-migration-d_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/api-migration-d.test.ts
      CLI_REGION: ap-southeast-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth-migration-b_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/auth-migration-b.test.ts
      CLI_REGION: us-east-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-migration-c_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/api-migration-c.test.ts
      CLI_REGION: eu-central-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth-migration-c_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/auth-migration-c.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_notifications-migration_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/notifications-migration/notifications-migration.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-migration-b_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/api-migration-b.test.ts
      CLI_REGION: ap-southeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth-migration-a_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/auth-migration-a.test.ts
      CLI_REGION: us-east-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-key-migration-2_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/transformer_migration/api.key.migration-2.test.ts
      CLI_REGION: ap-southeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-migration-a_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/api-migration-a.test.ts
      CLI_REGION: ap-southeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_notifications-migration-2_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/notifications-migration/notifications-migration-2.test.ts
      CLI_REGION: us-east-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_apigw-ext-migration_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests/overrides/apigw-ext-migration.test.ts
      CLI_REGION: ap-northeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_function_migration_update_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/function_migration_update.test.ts
      CLI_REGION: eu-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_storage_migration_update_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/storage_migration_update.test.ts
      CLI_REGION: eu-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth_migration_update_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/auth_migration_update.test.ts
      CLI_REGION: eu-central-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_notifications-migration-3_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests/notifications-migration/notifications-migration-3.test.ts
      CLI_REGION: us-east-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api_migration_update_v6:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.npm-global/lib/node_modules/@aws-amplify/cli/bin/amplify
      TEST_SUITE: src/__tests__/update_tests/api_migration_update.test.ts
      CLI_REGION: us-east-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v6.1.0
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            retry yarn run migration_v6.1.0 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_scaffold_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/scaffold.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_dotnet_runtime_update_migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: >-
        src/__tests__/migration_tests_v10/dotnet_runtime_update_migration.test.ts
      CLI_REGION: ap-southeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-graphql-v2-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/api-graphql-v2.migration.test.ts
      CLI_REGION: ap-northeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-rest-basic-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/api-rest-basic.migration.test.ts
      CLI_REGION: us-east-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-rest-lambda-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/api-rest-lambda.migration.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_api-rest-serverless-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/api-rest-serverless.migration.test.ts
      CLI_REGION: us-east-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth-add-all-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/auth-add-all.migration.test.ts
      CLI_REGION: ap-southeast-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_auth-override-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/auth-override.migration.test.ts
      CLI_REGION: us-east-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_custom-stack-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/custom-stack.migration.test.ts
      CLI_REGION: us-east-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_geo-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/geo.migration.test.ts
      CLI_REGION: eu-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_git-clone-migration-tests_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/git-clone-migration-tests.test.ts
      CLI_REGION: us-west-2
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
  l_storage-migration_v10:
    parameters:
      os:
        type: executor
        default: l_large
    executor: << parameters.os >>
    environment:
      AMPLIFY_PATH: /home/circleci/.amplify/bin/amplify
      TEST_SUITE: src/__tests__/migration_tests_v10/storage.migration.test.ts
      CLI_REGION: ap-northeast-1
    steps:
      - restore_cache:
          key: amplify-cli-repo-{{ .Branch }}-{{ .Revision }}
      - restore_cache:
          key: amplify-cli-yarn-deps-{{ .Branch }}-{{ checksum "yarn.lock" }}
      - restore_cache:
          key: amplify-pkg-binaries-{{ .Branch }}-{{ .Revision }}
      - run:
          name: Run tests migrating from CLI v10.5.1
          command: >
            source .circleci/local_publish_helpers.sh

            changeNpmGlobalPath

            cd packages/amplify-migration-tests

            unset IS_AMPLIFY_CI

            echo $IS_AMPLIFY_CI

            retry yarn run migration_v10.5.1 --no-cache --maxWorkers=4
            --forceExit $TEST_SUITE
          no_output_timeout: 65m
      - run:
          name: Scan And Cleanup E2E Test Artifacts
          no_output_timeout: 90m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
      - store_test_results:
          path: ~/repo/packages/amplify-migration-tests/
      - store_artifacts:
          path: ~/repo/packages/amplify-migration-tests/amplify-migration-reports
    working_directory: ~/repo
workflows:
  version: 3
  build_test_deploy_v3:
    jobs:
      - build:
          filters:
            branches:
              ignore:
                - beta
      - build_tests_standalone
      - build_windows_workspace_for_e2e:
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
      - lint:
          requires:
            - build
          filters:
            branches:
              ignore:
                - beta
                - release
                - /release_rc\/.*/
                - /tagged-release-without-e2e-tests\/.*/
                - /run-e2e\/.*/
      - verify-api-extract:
          requires:
            - build
          filters:
            branches:
              ignore:
                - beta
                - release
                - /release_rc\/.*/
                - /tagged-release-without-e2e-tests\/.*/
      - verify-yarn-lock:
          requires:
            - build
      - verify-versions-match:
          requires:
            - publish_to_local_registry
      - test:
          requires:
            - build
          filters:
            branches:
              ignore:
                - beta
                - release
                - /release_rc\/.*/
                - /tagged-release-without-e2e-tests\/.*/
      - validate_cdk_version:
          requires:
            - build
      - mock_e2e_tests:
          requires:
            - build
          filters:
            branches:
              ignore:
                - beta
                - release
                - /tagged-release-without-e2e-tests\/.*/
      - integration_test:
          context:
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - build
      - publish_to_local_registry:
          requires:
            - build
      - upload_pkg_binaries:
          filters:
            branches:
              only:
                - dev
                - release
                - /release_rc\/.*/
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /tagged-release-without-e2e-tests\/.*/
                - /run-e2e\/.*/
          context:
            - e2e-auth-credentials
            - e2e-test-context
            - amplify-s3-upload
          requires:
            - build_pkg_binaries_linux
            - build_pkg_binaries_macos
            - build_pkg_binaries_win
            - build_pkg_binaries_arm
      - build_pkg_binaries_linux:
          requires:
            - publish_to_local_registry
      - build_pkg_binaries_macos:
          requires:
            - publish_to_local_registry
      - build_pkg_binaries_win:
          requires:
            - publish_to_local_registry
      - build_pkg_binaries_arm:
          requires:
            - publish_to_local_registry
      - verify_pkg_binaries:
          requires:
            - build_pkg_binaries_linux
            - build_pkg_binaries_macos
            - build_pkg_binaries_win
            - build_pkg_binaries_arm
      - amplify_sudo_install_test:
          context: amplify-ecr-image-pull
          requires:
            - upload_pkg_binaries
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
      - cleanup_resources:
          context:
            - cleanup-resources
            - e2e-test-context
          requires:
            - build
          filters:
            branches:
              only:
                - dev
                - /tagged-release\/.*/
                - /run-e2e\/.*/
      - amplify_migration_tests_non_multi_env_layers:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
      - amplify_migration_tests_multi_env_layers:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
      - amplify_general_config_tests:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
      - amplify_console_integration_tests:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - console-e2e-test
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
          requires:
            - upload_pkg_binaries
      - github_prerelease:
          context: github-publish
          requires:
            - upload_pkg_binaries
          filters:
            branches:
              only:
                - release
      - github_prerelease_install_sanity_check:
          requires:
            - github_prerelease
          filters:
            branches:
              only:
                - release
      - wait_for_all:
          context:
            - cleanup-resources
            - e2e-test-context
          requires:
            - build
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
      - trigger_e2e_workflow_cleanup:
          context:
            - cleanup-resources
            - e2e-test-context
          requires:
            - wait_for_all
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
      - deploy:
          context:
            - e2e-auth-credentials
            - e2e-test-context
            - amplify-s3-upload
            - npm-publish
          requires:
            - test
            - mock_e2e_tests
            - integration_test
            - amplify_sudo_install_test
            - amplify_console_integration_tests
            - amplify_migration_tests_non_multi_env_layers
            - amplify_migration_tests_multi_env_layers
            - github_prerelease_install_sanity_check
            - upload_pkg_binaries
            - verify-versions-match
            - l_datastore-modelgen_amplify-app_diagnose_hooks-a
            - l_storage-2_export_iam-permissions-boundary_node-function
            - l_schema-auth-4c_schema-auth-5c_auth_5b_auth_9
            - l_schema-auth-1b_schema-auth-2a_schema-auth-7a_schema-auth-7b
            - >-
              l_api-key-migration4_schema-iterative-update-4_function_1_storage-5
            - l_auth_2e
            - l_import_s3_2c
            - l_schema-auth-11-a
            - l_geo-update-1
            - l_import_s3_2b
            - l_import_dynamodb_1
            - w_env-1_geo-add-a_auth_5b_function_10
            - >-
              l_mock-api_analytics-kinesis_analytics-pinpoint-flutter_analytics-pinpoint-js
            - l_notifications-sms-pull_pull_auth_10_container-hosting
            - l_notifications-sms_schema-auth-4b_schema-model-e_schema-versioned
            - l_auth_5f_env-4_frontend_config_drift_schema-auth-4d
            - l_auth_7b_export-pull-b_function_3a_init-special-case
            - l_api_2b_api_6c_api_9a_auth_12
            - >-
              l_parameter-store-2_android-analytics-pinpoint-config_android-notifications-pinpoint-config_flutter-analytics-pinpoint-config
            - l_api-connection-migration2_api_4_containers-api-secrets_storage-4
            - l_schema-key_api_5_apigw_api_lambda_auth_1
            - >-
              l_api-key-migration2_schema-searchable_api-key-migration1_schema-auth-14
            - l_api_3_api_6b_api_1_layer-1
            - l_auth_2c
            - l_notifications-in-app-messaging
            - l_containers-api-1
            - l_import_dynamodb_2a
            - w_hostingPROD
            - l_auth_2a_auth_2b_auth_2d_auth_2f
            - l_auth_1a_auth-trigger_custom_policies_function_function_6
            - l_auth_3b_auth_4a_auth_7a_auth_8c
            - l_feature-flags_geo-import-1b_global_sandbox-a_init_e
            - l_geo-add-d_geo-import-3_hosting_layer-3
            - >-
              l_schema-auth-9-b_schema-iterative-rollback-1_predictions-migration_api_6a
            - l_http-migration_schema-auth-12_schema-auth-3_schema-function-2
            - l_auth_4b_auth_8a_export-pull-d_schema-auth-5a
            - >-
              l_flutter-notifications-pinpoint-config_ios-analytics-pinpoint-config_ios-notifications-pinpoint-config_javascript-analytics-pinpoint-config
            - l_schema-auth-13_function_5_schema-iterative-update-1_auth_6
            - l_import_auth_2a
            - l_import_auth_1b
            - l_geo-update-2
            - l_hostingPROD
            - l_schema-auth-15
            - w_schema-auth-1a_auth_11_auth_7b_parameter-store-1
            - >-
              l_notifications-lifecycle_uibuilder_notifications-analytics-compatibility-in-app-1_notifications-analytics-compatibility-sms-2
            - l_function_4_interactions_schema-model-a_tags
            - >-
              l_schema-auth-6a_schema-data-access-patterns_schema-model-c_schema-predictions
            - l_model-migration_auth_3c_auth_4c_auth_5a
            - >-
              l_custom-resource-with-storage_dynamodb-simulator_export-pull-c_general-config-headless-init
            - l_help_init-force-push_interactions-1_interactions-2
            - l_javascript-notifications-pinpoint-config_push_S3server_api_8
            - >-
              l_function_8_schema-iterative-update-locking_api_lambda_auth_2_layer-2
            - l_containers-api-2
            - w_hooks-b_interactions_auth-trigger_custom_policies_function
            - >-
              w_function-permissions_global_sandbox-b_feature-flags_export-pull-a
            - >-
              l_analytics-2_global_sandbox-c_hooks-b_notifications-analytics-compatibility-sms-1
            - >-
              l_init_b_notifications-apns_notifications-fcm_notifications-in-app-messaging-env-2
            - l_custom_resources_env-5_function_10_function_9c
            - l_function-permissions_geo-import-1a_geo-import-2_global_sandbox-b
            - >-
              l_notifications-analytics-compatibility-in-app-2_schema-auth-11-c_schema-auth-2b_schema-auth-6c
            - l_api_10_api_7_export-pull-a_function_9a
            - l_geo-headless_api-key-migration5_schema-auth-1a_schema-auth-5b
            - l_auth_11_auth_1b_delete_geo-add-c
            - l_env-3
            - l_import_s3_3
            - l_import_dynamodb_2b
            - l_import_auth_3
            - l_searchable-migration
            - >-
              l_plugin_studio-modelgen_custom-transformers_notifications-in-app-messaging-env-1
            - l_auth_5c_env-1_geo-add-a_init_a
            - l_schema-auth-5d_schema-auth-6b_schema-auth-8c_auth_3a
            - >-
              l_schema-iterative-rollback-2_schema-iterative-update-3_auth-migration_api_2a
            - l_geo-add-e
            - l_import_dynamodb_2c
            - l_import_auth_2b
            - l_schema-connection-1
            - l_import_s3_1
            - l_with-babel-config_amplify-configure_env-2_init_d
            - l_auth_1c_auth_5e_auth_8b_geo-add-b
            - l_schema-auth-6d_schema-auth-7c_schema-auth-8a_function-migration
            - >-
              l_minify-cloudformation_notifications-multi-env_opensearch-simulator_parameter-store-1
            - l_function_2a_schema-connection-2_schema-function-1_api_9b
            - l_storage-1b_function_11_function_2b_function_7
            - l_schema-auth-10_geo-multi-env_searchable-datastore_resolvers
            - l_geo-remove-2
            - l_import_s3_2a
            - l_geo-remove-1
            - w_schema-model-e_auth_5e_auth_8b_auth_3c
            - >-
              w_parameter-store-2_schema-iterative-update-1_auth_6_containers-api-secrets
            - w_auth_2e
            - l_init_f_auth_5d_configure-project_git-clone-attach
            - l_init_c_layer-4_function_2c_function_3b
            - l_s3-sse_schema-auth-4a_schema-model-b_schema-model-d
            - l_schema-auth-8b_schema-auth-9-a_schema-auth-9-c_storage-3
            - >-
              l_api-connection-migration_api-key-migration3_predictions_schema-auth-11-b
            - >-
              l_custom_policies_container_function_9b_schema-iterative-update-2_storage-1a
            - l_geo-remove-3
            - l_geo-add-f
            - l_import_auth_1a
            - l_notifications-migration-4_v5
            - l_api-key-migration-2_v5
            - l_api-key-migration_v5
            - l_notifications-migration_v5
            - l_function_migration_update_v5
            - l_auth_migration_update_v5
            - l_notifications-migration-2_v5
            - l_storage_migration_update_v5
            - l_notifications-migration-3_v5
            - l_api_migration_update_v5
            - l_auth-migration-d_v6
            - l_auth-migration-e_v6
            - l_apigw-ext-migration_v6
            - l_init-migration_v6
            - l_api-migration-c_v6
            - l_auth_migration_update_v6
            - l_notifications-migration-4_v6
            - l_auth-migration-a_v6
            - l_notifications-migration-2_v6
            - l_api-key-migration_v6
            - l_auth-migration-c_v6
            - l_notifications-migration_v6
            - l_api-migration-d_v6
            - l_auth-migration-b_v6
            - l_notifications-migration-3_v6
            - l_api_migration_update_v6
            - l_api-migration-b_v6
            - l_api-key-migration-2_v6
            - l_api-migration-a_v6
            - l_function_migration_update_v6
            - l_storage_migration_update_v6
            - l_scaffold_v10
            - l_api-rest-lambda-migration_v10
            - l_git-clone-migration-tests_v10
            - l_dotnet_runtime_update_migration_v10
            - l_api-graphql-v2-migration_v10
            - l_storage-migration_v10
            - l_api-rest-basic-migration_v10
            - l_auth-override-migration_v10
            - l_api-rest-serverless-migration_v10
            - l_custom-stack-migration_v10
            - l_auth-add-all-migration_v10
            - l_geo-migration_v10
          filters:
            branches:
              only:
                - release
                - /release_rc\/.*/
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /tagged-release-without-e2e-tests\/.*/
      - github_release:
          context: github-publish
          requires:
            - deploy
          filters:
            branches:
              only:
                - release
      - l_datastore-modelgen_amplify-app_diagnose_hooks-a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_storage-2_export_iam-permissions-boundary_node-function:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-4c_schema-auth-5c_auth_5b_auth_9:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-1b_schema-auth-2a_schema-auth-7a_schema-auth-7b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_api-key-migration4_schema-iterative-update-4_function_1_storage-5:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_2e:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_s3_2c:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_schema-auth-11-a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_geo-update-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_s3_2b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_dynamodb_1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - w_env-1_geo-add-a_auth_5b_function_10:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
            - build_windows_workspace_for_e2e
          matrix:
            parameters:
              os:
                - w_medium
      - l_mock-api_analytics-kinesis_analytics-pinpoint-flutter_analytics-pinpoint-js:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_notifications-sms-pull_pull_auth_10_container-hosting:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_notifications-sms_schema-auth-4b_schema-model-e_schema-versioned:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_5f_env-4_frontend_config_drift_schema-auth-4d:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_7b_export-pull-b_function_3a_init-special-case:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_api_2b_api_6c_api_9a_auth_12:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_parameter-store-2_android-analytics-pinpoint-config_android-notifications-pinpoint-config_flutter-analytics-pinpoint-config:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_api-connection-migration2_api_4_containers-api-secrets_storage-4:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-key_api_5_apigw_api_lambda_auth_1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_api-key-migration2_schema-searchable_api-key-migration1_schema-auth-14:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_api_3_api_6b_api_1_layer-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_2c:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-in-app-messaging:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_containers-api-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_dynamodb_2a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - w_hostingPROD:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
            - build_windows_workspace_for_e2e
          matrix:
            parameters:
              os:
                - w_medium
      - l_auth_2a_auth_2b_auth_2d_auth_2f:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_1a_auth-trigger_custom_policies_function_function_6:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_3b_auth_4a_auth_7a_auth_8c:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_feature-flags_geo-import-1b_global_sandbox-a_init_e:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_geo-add-d_geo-import-3_hosting_layer-3:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-9-b_schema-iterative-rollback-1_predictions-migration_api_6a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_http-migration_schema-auth-12_schema-auth-3_schema-function-2:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_4b_auth_8a_export-pull-d_schema-auth-5a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_flutter-notifications-pinpoint-config_ios-analytics-pinpoint-config_ios-notifications-pinpoint-config_javascript-analytics-pinpoint-config:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-13_function_5_schema-iterative-update-1_auth_6:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_import_auth_2a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_auth_1b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_geo-update-2:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_hostingPROD:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_schema-auth-15:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - w_schema-auth-1a_auth_11_auth_7b_parameter-store-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
            - build_windows_workspace_for_e2e
          matrix:
            parameters:
              os:
                - w_medium
      - l_notifications-lifecycle_uibuilder_notifications-analytics-compatibility-in-app-1_notifications-analytics-compatibility-sms-2:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_function_4_interactions_schema-model-a_tags:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-6a_schema-data-access-patterns_schema-model-c_schema-predictions:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_model-migration_auth_3c_auth_4c_auth_5a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_custom-resource-with-storage_dynamodb-simulator_export-pull-c_general-config-headless-init:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_help_init-force-push_interactions-1_interactions-2:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_javascript-notifications-pinpoint-config_push_S3server_api_8:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_function_8_schema-iterative-update-locking_api_lambda_auth_2_layer-2:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_containers-api-2:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - w_hooks-b_interactions_auth-trigger_custom_policies_function:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
            - build_windows_workspace_for_e2e
          matrix:
            parameters:
              os:
                - w_medium
      - w_function-permissions_global_sandbox-b_feature-flags_export-pull-a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
            - build_windows_workspace_for_e2e
          matrix:
            parameters:
              os:
                - w_medium
      - l_analytics-2_global_sandbox-c_hooks-b_notifications-analytics-compatibility-sms-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_init_b_notifications-apns_notifications-fcm_notifications-in-app-messaging-env-2:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_custom_resources_env-5_function_10_function_9c:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_function-permissions_geo-import-1a_geo-import-2_global_sandbox-b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_notifications-analytics-compatibility-in-app-2_schema-auth-11-c_schema-auth-2b_schema-auth-6c:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_api_10_api_7_export-pull-a_function_9a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_geo-headless_api-key-migration5_schema-auth-1a_schema-auth-5b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_11_auth_1b_delete_geo-add-c:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_env-3:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_s3_3:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_dynamodb_2b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_auth_3:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_searchable-migration:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_plugin_studio-modelgen_custom-transformers_notifications-in-app-messaging-env-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_5c_env-1_geo-add-a_init_a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-5d_schema-auth-6b_schema-auth-8c_auth_3a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-iterative-rollback-2_schema-iterative-update-3_auth-migration_api_2a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_geo-add-e:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_dynamodb_2c:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_auth_2b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_schema-connection-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_s3_1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_with-babel-config_amplify-configure_env-2_init_d:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_auth_1c_auth_5e_auth_8b_geo-add-b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-6d_schema-auth-7c_schema-auth-8a_function-migration:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_minify-cloudformation_notifications-multi-env_opensearch-simulator_parameter-store-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_function_2a_schema-connection-2_schema-function-1_api_9b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_storage-1b_function_11_function_2b_function_7:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-10_geo-multi-env_searchable-datastore_resolvers:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_geo-remove-2:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_s3_2a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_geo-remove-1:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - w_schema-model-e_auth_5e_auth_8b_auth_3c:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
            - build_windows_workspace_for_e2e
          matrix:
            parameters:
              os:
                - w_medium
      - w_parameter-store-2_schema-iterative-update-1_auth_6_containers-api-secrets:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
            - build_windows_workspace_for_e2e
          matrix:
            parameters:
              os:
                - w_medium
      - w_auth_2e:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
            - build_windows_workspace_for_e2e
          matrix:
            parameters:
              os:
                - w_medium
      - l_init_f_auth_5d_configure-project_git-clone-attach:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_init_c_layer-4_function_2c_function_3b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_s3-sse_schema-auth-4a_schema-model-b_schema-model-d:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_schema-auth-8b_schema-auth-9-a_schema-auth-9-c_storage-3:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_api-connection-migration_api-key-migration3_predictions_schema-auth-11-b:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_custom_policies_container_function_9b_schema-iterative-update-2_storage-1a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_large
      - l_geo-remove-3:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_geo-add-f:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_import_auth_1a:
          context:
            - cleanup-resources
            - e2e-auth-credentials
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-migration-4_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-key-migration-2_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-key-migration_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-migration_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_function_migration_update_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth_migration_update_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-migration-2_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_storage_migration_update_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-migration-3_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api_migration_update_v5:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth-migration-d_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth-migration-e_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_apigw-ext-migration_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_init-migration_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-migration-c_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth_migration_update_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-migration-4_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth-migration-a_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-migration-2_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-key-migration_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth-migration-c_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-migration_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-migration-d_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth-migration-b_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_notifications-migration-3_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api_migration_update_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-migration-b_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-key-migration-2_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-migration-a_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_function_migration_update_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_storage_migration_update_v6:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_scaffold_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-rest-lambda-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_git-clone-migration-tests_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_dotnet_runtime_update_migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-graphql-v2-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_storage-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-rest-basic-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth-override-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_api-rest-serverless-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_custom-stack-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_auth-add-all-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
      - l_geo-migration_v10:
          context:
            - e2e-auth-credentials
            - cleanup-resources
            - e2e-test-context
          filters:
            branches:
              only:
                - dev
                - /run-e2e-with-rc\/.*/
                - /tagged-release\/.*/
                - /run-e2e\/.*/
          requires:
            - upload_pkg_binaries
          matrix:
            parameters:
              os:
                - l_medium
commands:
  install_packaged_cli:
    description: Install Amplify Packaged CLI to PATH
    parameters:
      os:
        type: executor
        default: l_large
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - run:
                shell: powershell.exe
                name: Rename the Packaged CLI to amplify
                command: |
                  # rename the command to amplify
                  cd /home/circleci/repo/out
                  cp amplify-pkg-win-x64.exe amplify.exe
            - run:
                shell: powershell.exe
                name: Move to CLI Binary to already existing PATH
                command: >
                  # This is a Hack to make sure the Amplify CLI is in the PATH

                  cp /home/circleci/repo/out/amplify.exe
                  $env:homedrive\$env:homepath\AppData\Local\Microsoft\WindowsApps
            - run:
                name: Confirm Amplify CLI is installed and available in PATH
                command: amplify version
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - run:
                name: Symlink Amplify packaged CLI
                command: |
                  cd out
                  ln -sf amplify-pkg-linux-x64 amplify
                  echo "export PATH=$AMPLIFY_DIR:$PATH" >> $BASH_ENV
                  source $BASH_ENV
            - run:
                name: Confirm Amplify CLI is installed and available in PATH
                command: amplify version
  rename_binary_for_windows:
    description: Rename binary for windows
    parameters:
      os:
        type: executor
        default: w_medium
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - run:
                shell: powershell.exe
                command: >-
                  cp /home/circleci/repo/out/amplify-pkg-win-x64.exe
                  $env:homedrive\$env:homepath\AppData\Local\Microsoft\WindowsApps\amplify.exe
  run_e2e_tests:
    description: Run Amplify E2E tests
    parameters:
      os:
        type: executor
        default: l_medium
    steps:
      - when:
          condition:
            equal:
              - machine:
                  image: windows-server-2019-vs2019:stable
                  resource_class: windows.medium
                  shell: bash.exe
                working_directory: ~/repo
                environment:
                  AMPLIFY_DIR: C:/home/circleci/repo/out
                  AMPLIFY_PATH: C:/home/circleci/repo/out/amplify.exe
              - << parameters.os >>
          steps:
            - run:
                name: Run E2e Tests
                shell: bash.exe
                command: |
                  source .circleci/local_publish_helpers.sh
                  source $BASH_ENV
                  amplify version
                  cd packages/amplify-e2e-tests
                  retry runE2eTest
                no_output_timeout: 65m
      - when:
          condition:
            or:
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: large
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
              - equal:
                  - docker:
                      - image: >-
                          public.ecr.aws/j4f5f3h7/amplify-cli-e2e-base-image-repo-public:latest
                    working_directory: ~/repo
                    resource_class: medium
                    environment:
                      AMPLIFY_DIR: /home/circleci/repo/out
                      AMPLIFY_PATH: /home/circleci/repo/out/amplify-pkg-linux-x64
                  - << parameters.os >>
          steps:
            - run:
                name: Run E2e Tests
                command: |
                  source .circleci/local_publish_helpers.sh
                  source $BASH_ENV
                  startLocalRegistry "$(pwd)/.circleci/verdaccio.yaml"
                  setNpmRegistryUrlToLocal
                  changeNpmGlobalPath
                  amplify version
                  cd packages/amplify-e2e-tests
                  retry runE2eTest
                no_output_timeout: 65m
  scan_e2e_test_artifacts:
    description: Scan And Cleanup E2E Test Artifacts
    parameters:
      os:
        type: executor
        default: l_large
    steps:
      - run:
          name: Scan E2E artifacts
          no_output_timeout: 2m
          command: |
            if ! yarn ts-node .circleci/scan_artifacts.ts; then
              echo "Cleaning the repository"
              git clean -fdx
              exit 1
            fi
          when: always
  install_node14_windows:
    description: Install Node 14 on Windows
    steps:
      - run:
          name: Install Node 14
          command: |
            nvm version
            nvm install 14.18
            nvm use 14.18
            nvm ls
      - run:
          name: Check Node, install yarn
          command: |
            node --version
            npm --version
            npm install -g yarn
            yarn --version
