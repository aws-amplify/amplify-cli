{
    "AWSTemplateFormatVersion" : "2010-09-09",
    "Description" : "Root stack for the amplify CloudFormation provider",
    "Parameters":{
        "DeploymentBucketName":{
            "Description": "Name of the common deployment bucket provided by the parent stack",
            "Type": "String",
            "Default": "DeploymentBucket"
        },
        "AuthRoleName":{
            "Type": "String",
            "Default": "AuthRoleName"
        },
        "UnauthRoleName":{
            "Type": "String",
            "Default": "UnauthRoleName"
        }
    }, 
    "Resources": {
        "DeploymentBucket" : {
            "Type" : "AWS::S3::Bucket", 
            "Properties": {
                "BucketName": {"Ref": "DeploymentBucketName"}
            }
        },
        "AuthRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": {"Ref": "AuthRoleName"},
                "AssumeRolePolicyDocument": {
                  "Version": "2012-10-17",
                  "Statement": [
                    {
                      "Sid": "",
                      "Effect": "Allow",
                      "Principal": {
                        "Federated": "cognito-identity.amazonaws.com"
                      },
                      "Action": "sts:AssumeRoleWithWebIdentity",
                      "Condition": {
                        "ForAnyValue:StringLike": {
                          "cognito-identity.amazonaws.com:amr": "authenticated"
                        }
                      }
                    }
                  ]
                }
            }
        },
        "UnauthRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "RoleName": {"Ref": "UnauthRoleName"},
                "AssumeRolePolicyDocument":{
                  "Version": "2012-10-17",
                  "Statement": [
                    {
                      "Sid": "",
                      "Effect": "Allow",
                      "Principal": {
                        "Federated": "cognito-identity.amazonaws.com"
                      },
                      "Action": "sts:AssumeRoleWithWebIdentity",
                      "Condition": {
                        "ForAnyValue:StringLike": {
                          "cognito-identity.amazonaws.com:amr": "unauthenticated"
                        }
                      }
                    }
                  ]
                }
            }

        }
    },
    "Outputs" : {
        "Region": {
            "Description": "CloudFormation provider root stack region", 
            "Value": {"Ref": "AWS::Region"},
            "Export": {
                "Name" : { "Fn::Sub" : "${AWS::StackName}-Region"}
            }
        }, 
        "StackId": {
            "Description": "CloudFormation provider root stack id", 
            "Value": {"Ref": "AWS::StackName"},
            "Export": {
                "Name" : { "Fn::Sub" : "${AWS::StackName}-StackId"}
            }
        }, 
        "StackName": {
            "Description": "CloudFormation provider root stack name", 
            "Value": {"Ref": "AWS::StackId"},
            "Export": {
                "Name" : { "Fn::Sub" : "${AWS::StackName}-StackName"}
            }
        },
        "DeploymentBucketName": {
            "Description": "CloudFormation provider root stack deployment bucket name", 
            "Value": {"Ref": "DeploymentBucketName"},
            "Export": {
                "Name" : { "Fn::Sub" : "${AWS::StackName}-DeploymentBucketName"}
            }
        },
        "AuthRoleArn": {
            "Value": {"Fn::GetAtt": ["AuthRole", "Arn"]}
        },
        "UnauthRoleArn": {
            "Value": {"Fn::GetAtt": ["UnauthRole", "Arn"]}
        },
        "AuthRoleName": {
            "Value": {"Ref": "AuthRole"}
        },
        "UnauthRoleName": {
            "Value": {"Ref": "UnauthRole"}
        }
    }
}