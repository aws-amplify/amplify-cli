{"version":3,"file":"kinesis-walkthrough.js","sourceRoot":"","sources":["../../../../src/provider-utils/awscloudformation/service-walkthroughs/kinesis-walkthrough.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-var-requires */\n/* eslint-disable global-require */\n/* eslint-disable import/no-dynamic-require */\n/* eslint-disable spellcheck/spell-checker */\nimport {\n  $TSAny,\n  $TSContext,\n  AmplifyCategories,\n  AmplifyError,\n  AmplifySupportedService,\n  exitOnNextTick,\n  IAmplifyResource,\n  ResourceDoesNotExistError,\n} from '@aws-amplify/amplify-cli-core';\nimport { alphanumeric, printer, prompter, integer } from '@aws-amplify/amplify-prompts';\nimport os from 'os';\nimport path from 'path';\n// FIXME: may be removed from here, since addResource can pass category to addWalkthrough\nconst category = AmplifyCategories.ANALYTICS;\nconst service = AmplifySupportedService.KINESIS;\n\n/**\n * Kinesis resource add walkthrough\n * @param context Amplify context\n * @param defaultValuesFilename Filename for default values to be configured in Kinesis\n * @param serviceMetadata Amplify Meta for analytics category kinesis resource\n * @returns kinesis resource name\n */\nexport const addWalkthrough = async (context: $TSContext, defaultValuesFilename: string, serviceMetadata: $TSAny): Promise<$TSContext> => {\n  const resourceName = resourceAlreadyExists(context);\n\n  if (resourceName) {\n    throw new AmplifyError('ResourceAlreadyExistsError', {\n      message: 'Kinesis resource have already been added to your project.',\n      resolution: 'Please run amplify update analytics to make changes to the existing Kinesis resource.',\n    });\n  }\n  return configure(context, defaultValuesFilename, serviceMetadata);\n};\n\n/**\n * migration not implemented/required\n */\nexport const migrate = (): void => {\n  // no-op for now\n};\n\ninterface IKinesisCRUDPolicy {\n  Effect: string;\n  Action: $TSAny;\n  Resource: $TSAny;\n}\ninterface IKinesisPolicyAttributes {\n  policy: IKinesisCRUDPolicy;\n  attributes: Array<$TSAny>;\n}\n\n/**\n * Auth resource configuration state.\n * requirementsMet is set to true if all required\n * configurations of the Auth resource have been configured.\n */\ninterface IAuthConfigRequirements {\n  errors: Array<string>;\n  authEnabled: boolean;\n  authImported: boolean;\n  authSelections: boolean;\n  allowUnauthenticatedIdentities: boolean;\n  requirementsMet: boolean;\n}\n\ninterface IKinesisCRUDPolicy {\n  Effect: string;\n  Action: $TSAny;\n  Resource: $TSAny;\n}\n\ninterface IKinesisPolicyAttributes {\n  policy: IKinesisCRUDPolicy;\n  attributes: Array<$TSAny>;\n}\n\ninterface IKinesisStreamInfo {\n  kinesisStreamName: string;\n  kinesisStreamShardCount: number;\n}\n\ninterface IKinesisAuthInfo {\n  authRoleName: { Ref: string };\n  unauthRoleName: { Ref: string };\n  authPolicyName: string;\n  unauthPolicyName: string;\n}\n\ninterface IKinesisInfo extends IKinesisStreamInfo, IKinesisAuthInfo {}\n\nconst configure = async (\n  context: $TSContext,\n  defaultValuesFilename: string,\n  serviceMetadata: $TSAny,\n  resourceName: string | null = null,\n): Promise<$TSAny> => {\n  const { amplify } = context;\n  const defaultValuesSrc = `${__dirname}/../default-values/${defaultValuesFilename}`;\n  const { getAllDefaults } = require(defaultValuesSrc);\n  const defaultValues: IKinesisInfo = getAllDefaults(amplify.getProjectDetails());\n  const projectBackendDirPath = amplify.pathManager.getBackendDirPath();\n\n  const answers = {\n    kinesisStreamName:\n      resourceName ||\n      (await prompter.input('Enter a Stream name', {\n        validate: alphanumeric('Name is invalid. Has to be non-empty and alphanumeric'),\n        initial: defaultValues.kinesisStreamName,\n      })),\n    kinesisStreamShardCount: await prompter.input<'one', number>('Enter number of shards', {\n      transform: (input) => Number.parseInt(input, 10),\n      initial: 1,\n      validate: integer(),\n    }),\n  };\n\n  const targetResourceName = answers.kinesisStreamName;\n  const shardCount = answers.kinesisStreamShardCount;\n  const templateDir = `${__dirname}/../cloudformation-templates`;\n  const resourceDirPath = path.join(projectBackendDirPath, category, targetResourceName);\n\n  if (!resourceName && resourceNameAlreadyExists(context, targetResourceName)) {\n    throw new Error(`Resource ${targetResourceName} already exists in ${category} category.`);\n  }\n\n  const copyJobs = [\n    {\n      dir: templateDir,\n      template: serviceMetadata.cfnFilename,\n      target: path.join(resourceDirPath, serviceMetadata.cfnFilename),\n      paramsFile: path.join(resourceDirPath, 'parameters.json'),\n    },\n  ];\n\n  const params = {\n    kinesisStreamName: targetResourceName,\n    kinesisStreamShardCount: shardCount,\n    authRoleName: defaultValues.authRoleName,\n    unauthRoleName: defaultValues.unauthRoleName,\n    authPolicyName: defaultValues.authPolicyName,\n    unauthPolicyName: defaultValues.unauthPolicyName,\n  };\n\n  const analyticsRequirements = {\n    authSelections: 'identityPoolOnly',\n    allowUnauthenticatedIdentities: true,\n  };\n\n  const checkResult: IAuthConfigRequirements = await context.amplify.invokePluginMethod(context, 'auth', undefined, 'checkRequirements', [\n    analyticsRequirements,\n    context,\n    'analytics',\n    targetResourceName,\n  ]);\n\n  // If auth is imported and configured, we have to throw the error instead of printing since there is no way to adjust the auth\n  // configuration.\n  if (checkResult.authImported === true && checkResult.errors && checkResult.errors.length > 0) {\n    throw new Error(checkResult.errors.join(os.EOL));\n  }\n\n  if (checkResult.errors && checkResult.errors.length > 0) {\n    printer.warn(checkResult.errors.join(os.EOL));\n  }\n\n  // If auth is not imported and there were errors, adjust or enable auth configuration\n  if (!checkResult.authEnabled || !checkResult.requirementsMet) {\n    printer.warn('Adding analytics would add the Auth category to the project if not already added.');\n    if (\n      !(await amplify.confirmPrompt(\n        'Apps need authorization to send analytics events. Do you want to allow guests and unauthenticated users to send analytics events? (we recommend you allow this when getting started)',\n      ))\n    ) {\n      printer.warn('Authorize only authenticated users to send analytics events. Use \"amplify update auth\" to modify this behavior.');\n      analyticsRequirements.allowUnauthenticatedIdentities = false;\n    }\n    await context.amplify.invokePluginMethod(context, 'auth', undefined, 'externalAuthEnable', [\n      context,\n      'analytics',\n      targetResourceName,\n      analyticsRequirements,\n    ]);\n  }\n\n  // At this point we have a valid auth configuration either imported or added/updated.\n  // allow overwrite in update case: resourceName specified\n  await amplify.copyBatch(context, copyJobs, {}, !!resourceName, params);\n  return targetResourceName;\n};\n\n/**\n * Returns true if a Kinesis resource already exists with the given name\n * @param context Amplify CLI context\n * @param name Kinesis resource name\n * @returns true if resource with the same name exists\n */\nconst resourceNameAlreadyExists = (context: $TSContext, name: string): boolean => {\n  const { amplify } = context;\n  const { amplifyMeta } = amplify.getProjectDetails();\n\n  return category in amplifyMeta ? Object.keys(amplifyMeta[category]).includes(name) : false;\n};\n\n/**\n * Kinesis resource CLI walkthrough\n * @param context Amplify CLI context\n * @param defaultValuesFilename File name for Kinesis default values\n * @param serviceMetadata Amplify Meta, Analytics resource for Kinesis service\n * @returns Kinesis resource name?( needs validation )\n */\nexport const updateWalkthrough = async (context: $TSContext, defaultValuesFilename: string, serviceMetadata: $TSAny): Promise<$TSAny> => {\n  const { amplify } = context;\n  const { allResources } = await amplify.getResourceStatus();\n  const kinesisResources = (allResources as IAmplifyResource[])\n    .filter((resource) => resource.service === service)\n    .map((resource) => resource.resourceName);\n\n  let targetResourceName;\n  if (kinesisResources.length === 0) {\n    const errMessage = 'No Kinesis streams resource to update. Please use \"amplify add analytics\" command to create a new Kinesis stream';\n    printer.error(errMessage);\n    await context.usageData.emitError(new ResourceDoesNotExistError(errMessage));\n    exitOnNextTick(0);\n    return;\n  }\n\n  if (kinesisResources.length === 1) {\n    [targetResourceName] = kinesisResources;\n    printer.success(`Selected resource ${targetResourceName}`);\n  } else {\n    targetResourceName = await prompter.pick('Please select the Kinesis stream you want to update', kinesisResources);\n  }\n\n  const result: $TSAny = await configure(context, defaultValuesFilename, serviceMetadata, targetResourceName as string);\n  // eslint-disable-next-line consistent-return\n  return result;\n};\n\n/**\n * Generates Kinesis policies based on CRUD operations\n * @param resourceName Kinesis resource name\n * @param crudOptions  ['create', 'read', 'update', 'delete']\n * @returns Kinesis policy for the given CRUD configuration\n */\nexport const getIAMPolicies = (resourceName: string, crudOptions: Array<$TSAny>): IKinesisPolicyAttributes => {\n  const actions = crudOptions\n    .map((crudOption) => {\n      switch (crudOption) {\n        case 'create':\n          return ['kinesis:CreateStream', 'kinesis:RegisterStreamConsumer', 'kinesis:AddTagsToStream'];\n\n        case 'update':\n          return [\n            'kinesis:EnableEnhancedMonitoring',\n            'kinesis:DisableEnhancedMonitoring',\n            'kinesis:IncreaseStreamRetentionPeriod',\n            'kinesis:DecreaseStreamRetentionPeriod',\n            'kinesis:MergeShards',\n            'kinesis:PutRecord',\n            'kinesis:PutRecords',\n            'kinesis:SplitShard',\n            'kinesis:UpdateShardCount',\n          ];\n\n        case 'read':\n          return [\n            'kinesis:ListShards',\n            'kinesis:ListStreams',\n            'kinesis:ListStreamConsumers',\n            'kinesis:DescribeStream',\n            'kinesis:DescribeStreamSummary',\n            'kinesis:DescribeStreamConsumer',\n            'kinesis:GetRecords',\n            'kinesis:GetShardIterator',\n            'kinesis:SubscribeToShard',\n            'kinesis:DescribeLimits',\n            'kinesis:ListTagsForStream',\n            'kinesis:SubscribeToShard',\n          ];\n\n        case 'delete':\n          return ['kinesis:DeleteStream', 'kinesis:DeregisterStreamConsumer', 'kinesis:RemoveTagsFromStream'];\n\n        default:\n          console.log(`${crudOption} not supported`);\n          return [];\n      }\n    })\n    .reduce((flattened, kinesisActions) => [...flattened, ...kinesisActions], []);\n\n  const policy = {\n    Effect: 'Allow',\n    Action: actions,\n    Resource: { Ref: `${category}${resourceName}kinesisStreamArn` },\n  };\n\n  const attributes = ['kinesisStreamArn'];\n  return { policy, attributes };\n};\n\n/**\n * Returns the resourceName if it already exists\n * @param context Amplify CLI context\n * @returns resourceName if found\n */\nconst resourceAlreadyExists = (context: $TSContext): string | undefined => {\n  const { amplify } = context;\n  const { amplifyMeta } = amplify.getProjectDetails();\n  let resourceName;\n\n  if (amplifyMeta[category]) {\n    const categoryResources = amplifyMeta[category];\n    Object.keys(categoryResources).forEach((resource) => {\n      if (categoryResources[resource].service === service) {\n        resourceName = resource;\n      }\n    });\n  }\n\n  return resourceName;\n};\n"]}