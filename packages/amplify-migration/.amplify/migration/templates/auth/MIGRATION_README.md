## Stack refactor steps for auth category
### STEP 1: UPDATE GEN-1 AUTH STACK
It is a non-disruptive update since the template only replaces resource references with their resolved values. This is a required step to execute cloudformation stack refactor later.
```
aws cloudformation update-stack \
 --stack-name amplify-testauth-dev-36113-authtestauth94a32e09-10D2TA5P5OHDH \
 --template-body file://.amplify/migration/templates/auth/step1-gen1PreProcessUpdateStackTemplate.json \
 --parameters '[{"ParameterKey":"hostedUIDomainName","ParameterValue":"testauth5cb39772-5cb39772"},{"ParameterKey":"authRoleArn","ParameterValue":"arn:aws:iam::517770102601:role/amplify-testauth-dev-36113-authRole"},{"ParameterKey":"authProviders","ParameterValue":""},{"ParameterKey":"autoVerifiedAttributes","ParameterValue":"email"},{"ParameterKey":"allowUnauthenticatedIdentities","ParameterValue":"false"},{"ParameterKey":"hostedUI","ParameterValue":"true"},{"ParameterKey":"smsVerificationMessage","ParameterValue":"Your verification code is {####}"},{"ParameterKey":"userpoolClientReadAttributes","ParameterValue":"email"},{"ParameterKey":"breakCircularDependency","ParameterValue":"true"},{"ParameterKey":"oAuthMetadata","ParameterValue":"{\"AllowedOAuthFlows\":[\"code\"],\"AllowedOAuthScopes\":[\"phone\",\"email\",\"openid\",\"profile\",\"aws.cognito.signin.user.admin\"],\"CallbackURLs\":[\"http://localhost:3000/\"],\"LogoutURLs\":[\"http://localhost:3000/signout/\"]}"},{"ParameterKey":"mfaTypes","ParameterValue":"SMS Text Message"},{"ParameterKey":"emailVerificationSubject","ParameterValue":"Your verification code"},{"ParameterKey":"sharedId","ParameterValue":"94a32e09"},{"ParameterKey":"useDefault","ParameterValue":"defaultSocial"},{"ParameterKey":"userpoolClientGenerateSecret","ParameterValue":"false"},{"ParameterKey":"mfaConfiguration","ParameterValue":"OFF"},{"ParameterKey":"identityPoolName","ParameterValue":"testauth94a32e09_identitypool_94a32e09"},{"ParameterKey":"authProvidersUserPool","ParameterValue":"Facebook"},{"ParameterKey":"userPoolGroupList","ParameterValue":""},{"ParameterKey":"authSelections","ParameterValue":"identityPoolAndUserPool"},{"ParameterKey":"resourceNameTruncated","ParameterValue":"testau94a32e09"},{"ParameterKey":"smsAuthenticationMessage","ParameterValue":"Your authentication code is {####}"},{"ParameterKey":"passwordPolicyMinLength","ParameterValue":"8"},{"ParameterKey":"userPoolName","ParameterValue":"testauth94a32e09_userpool_94a32e09"},{"ParameterKey":"hostedUIProviderMeta","ParameterValue":"[{\"ProviderName\":\"Facebook\",\"authorize_scopes\":\"email,public_profile\",\"AttributeMapping\":{\"email\":\"email\",\"username\":\"id\"}}]"},{"ParameterKey":"userpoolClientWriteAttributes","ParameterValue":"email"},{"ParameterKey":"dependsOn","ParameterValue":""},{"ParameterKey":"useEnabledMfas","ParameterValue":"true"},{"ParameterKey":"usernameCaseSensitive","ParameterValue":"false"},{"ParameterKey":"resourceName","ParameterValue":"testauth94a32e09"},{"ParameterKey":"env","ParameterValue":"dev"},{"ParameterKey":"serviceName","ParameterValue":"Cognito"},{"ParameterKey":"emailVerificationMessage","ParameterValue":"Your verification code is {####}"},{"ParameterKey":"userpoolClientRefreshTokenValidity","ParameterValue":"30"},{"ParameterKey":"userpoolClientSetAttributes","ParameterValue":"false"},{"ParameterKey":"unauthRoleArn","ParameterValue":"arn:aws:iam::517770102601:role/amplify-testauth-dev-36113-unauthRole"},{"ParameterKey":"requiredAttributes","ParameterValue":"email"},{"ParameterKey":"passwordPolicyCharacters","ParameterValue":""},{"ParameterKey":"aliasAttributes","ParameterValue":""},{"ParameterKey":"userpoolClientLambdaRole","ParameterValue":"testau94a32e09_userpoolclient_lambda_role"},{"ParameterKey":"defaultPasswordPolicy","ParameterValue":"false"},{"ParameterKey":"hostedUIProviderCreds","ParameterValue":"****"}]' \
 --capabilities CAPABILITY_NAMED_IAM
 ```
 
  ```
aws cloudformation describe-stacks \
 --stack-name amplify-testauth-dev-36113-authtestauth94a32e09-10D2TA5P5OHDH
 ```
 
 #### Rollback step:
 ```
 aws cloudformation update-stack \
 --stack-name amplify-testauth-dev-36113-authtestauth94a32e09-10D2TA5P5OHDH \
 --template-body file://.amplify/migration/templates/auth/step1-gen1PreProcessUpdateStackTemplate-rollback.json
 --parameters '[{"ParameterKey":"hostedUIDomainName","ParameterValue":"testauth5cb39772-5cb39772"},{"ParameterKey":"authRoleArn","ParameterValue":"arn:aws:iam::517770102601:role/amplify-testauth-dev-36113-authRole"},{"ParameterKey":"authProviders","ParameterValue":""},{"ParameterKey":"autoVerifiedAttributes","ParameterValue":"email"},{"ParameterKey":"allowUnauthenticatedIdentities","ParameterValue":"false"},{"ParameterKey":"hostedUI","ParameterValue":"true"},{"ParameterKey":"smsVerificationMessage","ParameterValue":"Your verification code is {####}"},{"ParameterKey":"userpoolClientReadAttributes","ParameterValue":"email"},{"ParameterKey":"breakCircularDependency","ParameterValue":"true"},{"ParameterKey":"oAuthMetadata","ParameterValue":"{\"AllowedOAuthFlows\":[\"code\"],\"AllowedOAuthScopes\":[\"phone\",\"email\",\"openid\",\"profile\",\"aws.cognito.signin.user.admin\"],\"CallbackURLs\":[\"http://localhost:3000/\"],\"LogoutURLs\":[\"http://localhost:3000/signout/\"]}"},{"ParameterKey":"mfaTypes","ParameterValue":"SMS Text Message"},{"ParameterKey":"emailVerificationSubject","ParameterValue":"Your verification code"},{"ParameterKey":"sharedId","ParameterValue":"94a32e09"},{"ParameterKey":"useDefault","ParameterValue":"defaultSocial"},{"ParameterKey":"userpoolClientGenerateSecret","ParameterValue":"false"},{"ParameterKey":"mfaConfiguration","ParameterValue":"OFF"},{"ParameterKey":"identityPoolName","ParameterValue":"testauth94a32e09_identitypool_94a32e09"},{"ParameterKey":"authProvidersUserPool","ParameterValue":"Facebook"},{"ParameterKey":"userPoolGroupList","ParameterValue":""},{"ParameterKey":"authSelections","ParameterValue":"identityPoolAndUserPool"},{"ParameterKey":"resourceNameTruncated","ParameterValue":"testau94a32e09"},{"ParameterKey":"smsAuthenticationMessage","ParameterValue":"Your authentication code is {####}"},{"ParameterKey":"passwordPolicyMinLength","ParameterValue":"8"},{"ParameterKey":"userPoolName","ParameterValue":"testauth94a32e09_userpool_94a32e09"},{"ParameterKey":"hostedUIProviderMeta","ParameterValue":"[{\"ProviderName\":\"Facebook\",\"authorize_scopes\":\"email,public_profile\",\"AttributeMapping\":{\"email\":\"email\",\"username\":\"id\"}}]"},{"ParameterKey":"userpoolClientWriteAttributes","ParameterValue":"email"},{"ParameterKey":"dependsOn","ParameterValue":""},{"ParameterKey":"useEnabledMfas","ParameterValue":"true"},{"ParameterKey":"usernameCaseSensitive","ParameterValue":"false"},{"ParameterKey":"resourceName","ParameterValue":"testauth94a32e09"},{"ParameterKey":"env","ParameterValue":"dev"},{"ParameterKey":"serviceName","ParameterValue":"Cognito"},{"ParameterKey":"emailVerificationMessage","ParameterValue":"Your verification code is {####}"},{"ParameterKey":"userpoolClientRefreshTokenValidity","ParameterValue":"30"},{"ParameterKey":"userpoolClientSetAttributes","ParameterValue":"false"},{"ParameterKey":"unauthRoleArn","ParameterValue":"arn:aws:iam::517770102601:role/amplify-testauth-dev-36113-unauthRole"},{"ParameterKey":"requiredAttributes","ParameterValue":"email"},{"ParameterKey":"passwordPolicyCharacters","ParameterValue":""},{"ParameterKey":"aliasAttributes","ParameterValue":""},{"ParameterKey":"userpoolClientLambdaRole","ParameterValue":"testau94a32e09_userpoolclient_lambda_role"},{"ParameterKey":"defaultPasswordPolicy","ParameterValue":"false"},{"ParameterKey":"hostedUIProviderCreds","ParameterValue":"****"}]' \
 --capabilities CAPABILITY_NAMED_IAM
 ```
 
  ```
aws cloudformation describe-stacks \
 --stack-name amplify-testauth-dev-36113-authtestauth94a32e09-10D2TA5P5OHDH
 ```
 