# Product Catalog - Amplify Gen1 Setup Guide

An inventory management application built with Amplify Gen1, featuring role-based authentication, GraphQL API, Lambda functions, S3 storage, and DynamoDB.

## Categories

### api
GraphQL API with schema containing Product, User, and Comment models with one-to-many relationships. Uses IAM for default auth with API key and Cognito as additional auth types. Includes custom query (checkLowStock) that invokes Lambda function for low stock monitoring.

### auth
Cognito-based authentication using email with role-based access control (ADMIN, MANAGER, VIEWER). Auto-configured during API setup.

### storage
- DynamoDB tables for Products, Users, and Comments (auto-generated by @model directive)
- S3 bucket (productimages3bucket) for authenticated users to create/update, read, and delete product images

### function
Node.js Lambda function (lowstockproductcatalog) that queries products via GraphQL API and returns list of products with stock below threshold (default: 5 units).

### hosting
Amplify Console-managed hosting with automatic deployments from GitHub.

## Description

This is an inventory management app with role-based access control. Products contain serial numbers, names, prices, categories, stock levels, brands, descriptions, and images stored in S3.

Users must sign up with email. First user becomes ADMIN automatically, subsequent users start as VIEWER. Once authenticated, users can perform actions based on their role: ADMIN (full access, user management), MANAGER (create/edit products), VIEWER (read-only, comments).

Product images are stored in S3 bucket (productimages3bucket) with auth-only access. Low stock monitoring is handled via Lambda function (lowstockproductcatalog) invoked through GraphQL checkLowStock query. Products, Users, and Comments use DynamoDB tables auto-generated by Amplify's @model directive. CRUD operations are via GraphQL with AWS AppSync. Auth is managed through Cognito with IAM as primary authorization and API key for public read access. Hosting is managed through Amplify Console.

---



 ### Step 1: Initialize the project

```
amplify init
```
```
Do you want to continue with Amplify Gen 1? (y/N) · yes  
Why would you like to use Amplify Gen 1? · Prefer not to answer  
Enter a name for the project productcatalog  

The following configuration will be applied:  
Project information  
| Name: productcatalog 
| Environment: dev  
| Default editor: Visual Studio Code  
| App type: javascript  
| Javascript framework: react
| Source Directory Path: src  
| Distribution Directory Path: dist  
| Build Command: npm run-script build  
| Start Command: npm run-script start  

? Initialize the project with the above configuration? Yes  
Using default provider awscloudformation  
? Select the authentication method you want to use: AWS profile
? Please choose the profile you want to use: default
```

### Step 2: Add GraphQL API

```
amplify add api
```
```
? Select from one of the below mentioned services: GraphQL
? Here is the GraphQL API that we will create. Select a setting to edit or continue Authorization modes: API key (default, expiration time: 7 days from now)
? Choose the default authorization type for the API IAM
? Configure additional auth types? Yes
? Choose the additional authorization types you want to configure for the API API key, Amazon Cognito User Pool
API key configuration
✔ Enter a description for the API key: · graphqlapi
✔ After how many days from now the API key should expire (1-365): · 7
Cognito UserPool configuration
Using service: Cognito, provided by: awscloudformation
 
 The current configured provider is Amazon Cognito. 
 
 Do you want to use the default authentication and security configuration? Default configuration
 Warning: you will not be able to edit these selections. 
 How do you want users to be able to sign in? Email
 Do you want to configure advanced settings? No, I am done.

? Here is the GraphQL API that we will create. Select a setting to edit or continue Continue
? Choose a schema template: One-to-many relationship (e.g., “Blogs” with “Posts” and “Comments”)

✔ Do you want to edit the schema now? (Y/n) · yes

Edit the file in your editor: /amplify/backend/api/<function-name>/schema.graphql
```

```graphql
# Multi-user Product Catalog with IAM-based Role Access Control

enum UserRole {
  ADMIN
  MANAGER
  VIEWER
}

type User @model @auth(rules: [
  { allow: private, provider: iam },
  { allow: owner, ownerField: "id" }
]) {
  id: ID!
  email: String!
  name: String!
  role: UserRole!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Product @model @auth(rules: [
  { allow: private, provider: iam },
  { allow: public, provider: apiKey, operations: [read] }
]) {
  id: ID!
  serialno: Int!
  engword: String!
  price: Float
  category: String
  description: String
  stock: Int
  brand: String
  imageKey: String
  images: [String]
  createdBy: String
  updatedBy: String
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  comments: [Comment] @hasMany(indexName: "byProduct", fields: ["id"])
}

type Comment @model @auth(rules: [
  { allow: private, provider: iam },
  { allow: owner, ownerField: "authorId" }
]) {
  id: ID!
  productId: ID! @index(name: "byProduct")
  product: Product @belongsTo(fields: ["productId"])
  authorId: String!
  authorName: String!
  content: String!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type LowStockProduct {
  name: String!
  stock: Int!
}

type LowStockResponse {
  message: String!
  lowStockProducts: [LowStockProduct!]!
}

type Query {
  checkLowStock: LowStockResponse @function(name: "lowstockproductcatalog-${env}") @auth(rules: [
    { allow: private, provider: iam },
    { allow: public, provider: apiKey }
  ])
}
```
### Step 3: Add S3 Storage

```
amplify add storage
```
```
? Select from one of the below mentioned services: Content (Images, audio, video, etc.)
✔ Provide a friendly name for your resource that will be used to label this category in the project: · productimages3
✔ Provide bucket name: · productimages3bucket
✔ Who should have access: · Auth users only
✔ What kind of access do you want for Authenticated users? · create/update, read, delete
✔ Do you want to add a Lambda Trigger for your S3 Bucket? (y/N) · no
```

### Step 4: Add Lambda function to display low stock alerts

```
amplify add function
```
```
 Select which capability you want to add: Lambda function (serverless function)
? Provide an AWS Lambda function name: lowstockproductcatalog
? Choose the runtime that you want to use: NodeJS
? Choose the function template that you want to use: Hello World

 Do you want to configure advanced settings? Yes
? Do you want to access other resources in this project from your Lambda function? Yes
? Select the categories you want this function to have access to. 
 ◉ api
 ◯ auth
 ◯ storage

? Select the operations you want to permit on productcatalog Query
? Do you want to invoke this function on a recurring schedule? No
? Do you want to enable Lambda layers for this function? No
? Do you want to configure environment variables for this function? No
? Do you want to configure secret values this function can access? No
✔ Choose the package manager that you want to use: · NPM

Do you want to edit the local lambda function now? Yes
Edit the file in your editor: amplify/backend/function/lowstockproductcatalog/src/index.js
? Press enter to continue
```
In the lowstockproductcatalog/src/index.js file, replace existing code with the following code.
**Note: Make sure the commented out portion at the beginning does not get deleted.** 

```
const https = require('https');

const GRAPHQL_ENDPOINT = process.env.API_PRODUCTCATALOG_GRAPHQLAPIENDPOINTOUTPUT;
const GRAPHQL_API_KEY = process.env.API_PRODUCTCATALOG_GRAPHQLAPIKEYOUTPUT;
const LOW_STOCK_THRESHOLD = parseInt(process.env.LOW_STOCK_THRESHOLD) || 5;

const listProductsQuery = `
  query ListProducts {
    listProducts {
      items {
        id
        engword
        stock
        price
        category
      }
    }
  }
`;

exports.handler = async (event) => {
    console.log(`EVENT: ${JSON.stringify(event)}`);
    
    try {
        const products = await fetchProducts();
        const lowStockProducts = products.filter(product => 
            product.stock !== null && product.stock < LOW_STOCK_THRESHOLD
        );
        
        console.log(`Found ${lowStockProducts.length} low stock products`);
        
        return {
            message: `Checked ${products.length} products, found ${lowStockProducts.length} low stock items`,
            lowStockProducts: lowStockProducts.map(p => ({
                name: p.engword,
                stock: p.stock
            }))
        };
        
    } catch (error) {
        console.error('Error checking stock:', error.message);
        console.error('Full error:', error);
        throw new Error(`Error checking stock: ${error.message}`);
    }
};

async function fetchProducts() {
    return new Promise((resolve, reject) => {
        const postData = JSON.stringify({
            query: listProductsQuery
        });
        
        const url = new URL(GRAPHQL_ENDPOINT);
        const options = {
            hostname: url.hostname,
            port: 443,
            path: url.pathname,
            method: 'POST',
            headers: {
                'content-type': 'application/json',
                'x-api-key': GRAPHQL_API_KEY,
                'Content-Length': Buffer.byteLength(postData)
            }
        };
        
        const req = https.request(options, (res) => {
            let data = '';
            
            res.on('data', (chunk) => {
                data += chunk;
            });
            
            res.on('end', () => {
                try {
                    const response = JSON.parse(data);
                    if (response.errors) {
                        reject(new Error(response.errors[0].message));
                    } else {
                        resolve(response.data.listProducts.items || []);
                    }
                } catch (error) {
                    reject(error);
                }
            });
        });
        
        req.on('error', (error) => {
            reject(error);
        });
        
        req.write(postData);
        req.end();
    });
}
```

```
amplify push
```
```
npm install
```
### Step 4: Add Lambda function to display low stock alerts

```
amplify add custom
```
```
✔ How do you want to define this custom resource? · AWS CDK
✔ Provide a name for your custom resource · customProdInventory
✅ Created skeleton CDK stack in amplify/backend/custom/customProdInventory directory
✔ Do you want to edit the CDK stack now? (Y/n) · yes
Edit the file in your editor: amplify/backend/custom/customProdInventory/cdk-stack.ts
? Press enter to continue
```
In the custom/customProdInventory/cdk-stack.ts file, replace existing code with the following code.

```
import * as cdk from 'aws-cdk-lib';
import * as AmplifyHelpers from '@aws-amplify/cli-extensibility-helper';
import { AmplifyDependentResourcesAttributes } from '../../types/amplify-dependent-resources-ref';
import { Construct } from 'constructs';
import * as iam from 'aws-cdk-lib/aws-iam';
import * as sns from 'aws-cdk-lib/aws-sns';
import * as subs from 'aws-cdk-lib/aws-sns-subscriptions';
import * as lambda from 'aws-cdk-lib/aws-lambda';
import * as events from 'aws-cdk-lib/aws-events';
import * as targets from 'aws-cdk-lib/aws-events-targets';

export class cdkStack extends cdk.Stack {
constructor(scope: Construct, id: string, props?: cdk.StackProps, amplifyResourceProps?: AmplifyHelpers.AmplifyResourceProps) {
super(scope, id, props);

new cdk.CfnParameter(this, 'env', {
type: 'String',
description: 'Current Amplify CLI env name',
});

const amplifyProjectInfo = AmplifyHelpers.getProjectInfo();

const amplifyResources: AmplifyDependentResourcesAttributes = AmplifyHelpers.addResourceDependency(
this as any,
amplifyResourceProps!.category,
amplifyResourceProps!.resourceName,
      [
        { category: 'auth', resourceName: 'productcatalog6e145452' },
        { category: 'api', resourceName: 'productcatalog' },
        { category: 'function', resourceName: 'lowstockproductcatalog' }
      ]
);

    // Resource references
    const userPoolId = amplifyResources.auth.productcatalog6e145452.UserPoolId;
    const graphqlApiId = amplifyResources.api.productcatalog.GraphQLAPIIdOutput;
    const graphqlEndpoint = amplifyResources.api.productcatalog.GraphQLAPIEndpointOutput;
    const graphqlApiKey = amplifyResources.api.productcatalog.GraphQLAPIKeyOutput;
    const functionArn = amplifyResources.function.lowstockproductcatalog.Arn;

const topic = new sns.Topic(this, 'InventoryAlertTopic');

const inventoryChecker = new lambda.Function(this, 'InventoryChecker', {
functionName: `inventory-checker-${amplifyProjectInfo.projectName}-${cdk.Fn.ref('env')}`,
runtime: lambda.Runtime.NODEJS_18_X,
handler: 'index.handler',
timeout: cdk.Duration.seconds(30),
code: lambda.Code.fromInline(`
const { PublishCommand, SNSClient } = require('@aws-sdk/client-sns');
const https = require('https');
const snsClient = new SNSClient({ region: process.env.AWS_REGION });

exports.handler = async () => {
 const products = await fetchProducts();
 const lowStock = products.filter(p => p.stock !== null && p.stock < 5);
 
 if (lowStock.length > 0) {
   const message = \`Low Stock Alert: \${lowStock.length} products need restocking\`;
   
   await snsClient.send(new PublishCommand({
     TopicArn: process.env.SNS_TOPIC_ARN,
     Subject: 'Inventory Alert',
     Message: message
   }));
 }
 
 return { statusCode: 200, lowStockCount: lowStock.length };
};

async function fetchProducts() {
 return new Promise((resolve, reject) => {
   const query = 'query ListProducts { listProducts { items { id engword stock } } }';
   const postData = JSON.stringify({ query });
   const url = new URL(process.env.GRAPHQL_ENDPOINT);
   
   const req = https.request({
     hostname: url.hostname,
     port: 443,
     path: url.pathname,
     method: 'POST',
     headers: {
       'content-type': 'application/json',
       'x-api-key': process.env.GRAPHQL_API_KEY,
       'Content-Length': Buffer.byteLength(postData)
     }
   }, (res) => {
     let data = '';
     res.on('data', (chunk) => data += chunk);
     res.on('end', () => {
       const response = JSON.parse(data);
       resolve(response.data?.listProducts?.items || []);
     });
   });
   
   req.on('error', reject);
   req.write(postData);
   req.end();
 });
}
     `),
environment: {
SNS_TOPIC_ARN: topic.topicArn,
        GRAPHQL_ENDPOINT: graphqlEndpoint,
        GRAPHQL_API_KEY: graphqlApiKey,
        USER_POOL_ID: userPoolId,
        FUNCTION_ARN: functionArn
}
});

const emailNotifier = new lambda.Function(this, 'EmailNotifier', {
functionName: `email-notifier-${amplifyProjectInfo.projectName}-${cdk.Fn.ref('env')}`,
runtime: lambda.Runtime.NODEJS_18_X,
handler: 'index.handler',
code: lambda.Code.fromInline(`
const { SESClient, SendEmailCommand } = require('@aws-sdk/client-ses');
const sesClient = new SESClient({ region: process.env.AWS_REGION });

exports.handler = async (event) => {
 for (const record of event.Records) {
   const { Subject, Message } = record.Sns;
   
   await sesClient.send(new SendEmailCommand({
     Source: process.env.SOURCE_EMAIL,
     Destination: { ToAddresses: [process.env.ADMIN_EMAIL] },
     Message: {
       Subject: { Data: Subject },
       Body: { Text: { Data: Message } }
     }
   }));
 }
};
     `),
environment: {
SOURCE_EMAIL: 'noreply@example.com',
ADMIN_EMAIL: 'admin@example.com'
}
});

topic.addSubscription(new subs.LambdaSubscription(emailNotifier));

const rule = new events.Rule(this, 'DailyInventoryCheck', {
schedule: events.Schedule.cron({ minute: '0', hour: '9' })
});
rule.addTarget(new targets.LambdaFunction(inventoryChecker));

topic.grantPublish(inventoryChecker);
emailNotifier.addToRolePolicy(new iam.PolicyStatement({
actions: ['ses:SendEmail', 'ses:SendRawEmail'],
resources: ['*']
}));

new cdk.CfnOutput(this, 'InventoryAlertTopicArn', {
value: topic.topicArn,
description: 'SNS Topic ARN for inventory alerts'
});

new cdk.CfnOutput(this, 'InventoryCheckerFunctionName', {
value: inventoryChecker.functionName,
description: 'Lambda function that checks inventory levels'
});

    new cdk.CfnOutput(this, 'UserPoolIdRef', {
      value: userPoolId,
      description: 'Cognito User Pool ID'
    });

    new cdk.CfnOutput(this, 'GraphQLApiIdRef', {
      value: graphqlApiId,
      description: 'AppSync GraphQL API ID'
    });

    new cdk.CfnOutput(this, 'LowStockFunctionRef', {
      value: functionArn,
      description: 'Low Stock Lambda Function ARN'
    });
}
}
```
```
amplify push
```
The storage dependency can be added now. Copy paste the following code into the cdk-stack.ts file.

```
import * as cdk from 'aws-cdk-lib';
import * as AmplifyHelpers from '@aws-amplify/cli-extensibility-helper';
import { AmplifyDependentResourcesAttributes } from '../../types/amplify-dependent-resources-ref';
import { Construct } from 'constructs';
import * as iam from 'aws-cdk-lib/aws-iam';
import * as sns from 'aws-cdk-lib/aws-sns';
import * as subs from 'aws-cdk-lib/aws-sns-subscriptions';
import * as lambda from 'aws-cdk-lib/aws-lambda';
import * as events from 'aws-cdk-lib/aws-events';
import * as targets from 'aws-cdk-lib/aws-events-targets';

export class cdkStack extends cdk.Stack {
constructor(scope: Construct, id: string, props?: cdk.StackProps, amplifyResourceProps?: AmplifyHelpers.AmplifyResourceProps) {
super(scope, id, props);

new cdk.CfnParameter(this, 'env', {
type: 'String',
description: 'Current Amplify CLI env name',
});

const amplifyProjectInfo = AmplifyHelpers.getProjectInfo();

const amplifyResources: AmplifyDependentResourcesAttributes = AmplifyHelpers.addResourceDependency(
this as any,
amplifyResourceProps!.category,
amplifyResourceProps!.resourceName,
      [
        { category: 'auth', resourceName: 'productcatalog6e145452' },
        { category: 'api', resourceName: 'productcatalog' },
        { category: 'storage', resourceName: 'productimages3' },
        { category: 'function', resourceName: 'lowstockproductcatalog' }
      ]
);

    // Resource references
    const userPoolId = amplifyResources.auth.productcatalog6e145452.UserPoolId;
    const graphqlApiId = amplifyResources.api.productcatalog.GraphQLAPIIdOutput;
    const graphqlEndpoint = amplifyResources.api.productcatalog.GraphQLAPIEndpointOutput;
    const graphqlApiKey = amplifyResources.api.productcatalog.GraphQLAPIKeyOutput;
    const bucketName = amplifyResources.storage.productimages3.BucketName;
    const functionArn = amplifyResources.function.lowstockproductcatalog.Arn;

const topic = new sns.Topic(this, 'InventoryAlertTopic');

const inventoryChecker = new lambda.Function(this, 'InventoryChecker', {
functionName: `inventory-checker-${amplifyProjectInfo.projectName}-${cdk.Fn.ref('env')}`,
runtime: lambda.Runtime.NODEJS_18_X,
handler: 'index.handler',
timeout: cdk.Duration.seconds(30),
code: lambda.Code.fromInline(`
const { PublishCommand, SNSClient } = require('@aws-sdk/client-sns');
const https = require('https');
const snsClient = new SNSClient({ region: process.env.AWS_REGION });

exports.handler = async () => {
 const products = await fetchProducts();
 const lowStock = products.filter(p => p.stock !== null && p.stock < 5);
 
 if (lowStock.length > 0) {
   const message = \`Low Stock Alert: \${lowStock.length} products need restocking\`;
   
   await snsClient.send(new PublishCommand({
     TopicArn: process.env.SNS_TOPIC_ARN,
     Subject: 'Inventory Alert',
     Message: message
   }));
 }
 
 return { statusCode: 200, lowStockCount: lowStock.length };
};

async function fetchProducts() {
 return new Promise((resolve, reject) => {
   const query = 'query ListProducts { listProducts { items { id engword stock } } }';
   const postData = JSON.stringify({ query });
   const url = new URL(process.env.GRAPHQL_ENDPOINT);
   
   const req = https.request({
     hostname: url.hostname,
     port: 443,
     path: url.pathname,
     method: 'POST',
     headers: {
       'content-type': 'application/json',
       'x-api-key': process.env.GRAPHQL_API_KEY,
       'Content-Length': Buffer.byteLength(postData)
     }
   }, (res) => {
     let data = '';
     res.on('data', (chunk) => data += chunk);
     res.on('end', () => {
       const response = JSON.parse(data);
       resolve(response.data?.listProducts?.items || []);
     });
   });
   
   req.on('error', reject);
   req.write(postData);
   req.end();
 });
}
     `),
environment: {
SNS_TOPIC_ARN: topic.topicArn,
        GRAPHQL_ENDPOINT: graphqlEndpoint,
        GRAPHQL_API_KEY: graphqlApiKey,
        USER_POOL_ID: userPoolId,
        BUCKET_NAME: bucketName,
        FUNCTION_ARN: functionArn
}
});

const emailNotifier = new lambda.Function(this, 'EmailNotifier', {
functionName: `email-notifier-${amplifyProjectInfo.projectName}-${cdk.Fn.ref('env')}`,
runtime: lambda.Runtime.NODEJS_18_X,
handler: 'index.handler',
code: lambda.Code.fromInline(`
const { SESClient, SendEmailCommand } = require('@aws-sdk/client-ses');
const sesClient = new SESClient({ region: process.env.AWS_REGION });

exports.handler = async (event) => {
 for (const record of event.Records) {
   const { Subject, Message } = record.Sns;
   
   await sesClient.send(new SendEmailCommand({
     Source: process.env.SOURCE_EMAIL,
     Destination: { ToAddresses: [process.env.ADMIN_EMAIL] },
     Message: {
       Subject: { Data: Subject },
       Body: { Text: { Data: Message } }
     }
   }));
 }
};
     `),
environment: {
SOURCE_EMAIL: 'noreply@example.com',
ADMIN_EMAIL: 'admin@example.com'
}
});

topic.addSubscription(new subs.LambdaSubscription(emailNotifier));

const rule = new events.Rule(this, 'DailyInventoryCheck', {
schedule: events.Schedule.cron({ minute: '0', hour: '9' })
});
rule.addTarget(new targets.LambdaFunction(inventoryChecker));

topic.grantPublish(inventoryChecker);
emailNotifier.addToRolePolicy(new iam.PolicyStatement({
actions: ['ses:SendEmail', 'ses:SendRawEmail'],
resources: ['*']
}));

new cdk.CfnOutput(this, 'InventoryAlertTopicArn', {
value: topic.topicArn,
description: 'SNS Topic ARN for inventory alerts'
});

new cdk.CfnOutput(this, 'InventoryCheckerFunctionName', {
value: inventoryChecker.functionName,
description: 'Lambda function that checks inventory levels'
});

    new cdk.CfnOutput(this, 'UserPoolIdRef', {
      value: userPoolId,
      description: 'Cognito User Pool ID'
    });

    new cdk.CfnOutput(this, 'GraphQLApiIdRef', {
      value: graphqlApiId,
      description: 'AppSync GraphQL API ID'
    });

    new cdk.CfnOutput(this, 'StorageBucketRef', {
      value: bucketName,
      description: 'S3 Storage Bucket Name'
    });

    new cdk.CfnOutput(this, 'LowStockFunctionRef', {
      value: functionArn,
      description: 'Low Stock Lambda Function ARN'
    });
}
}
```
To add cloudformation custom resources:

```
amplify add custom
```
```
✔ How do you want to define this custom resource? · AWS CloudFormation
✔ Provide a name for your custom resource · cfncustom
✔ Do you want to access Amplify generated resources in your custom CloudFormation file? (y/N) · yes

✔ Select the categories you want this custom resource to have access to. · api, auth, custom, function, storage

✔ Custom has 2 resources in this project. Select the one you would like your custom resource to access · customProdInventory

✅ Created skeleton CloudFormation stack in amplify/backend/custom/cfncustom directory
✔ Do you want to edit the CloudFormation stack now? (Y/n) · yes
Edit the file in your editor: amplify/backend/custom/cfncustom/cfncustom-cloudformation-template.json
? Press enter to continue 
```
Copy paste the following code into amplify/backend/custom/cfncustom/cfncustom-cloudformation-template.json:

```
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Parameters": {
    "env": {
      "Type": "String"
    },
    "apiproductcatalogGraphQLAPIKeyOutput": {
      "Type": "String",
      "Description": "Input parameter describing GraphQLAPIKeyOutput attribute for api/productcatalog resource"
    },
    "apiproductcatalogGraphQLAPIIdOutput": {
      "Type": "String",
      "Description": "Input parameter describing GraphQLAPIIdOutput attribute for api/productcatalog resource"
    },
    "apiproductcatalogGraphQLAPIEndpointOutput": {
      "Type": "String",
      "Description": "Input parameter describing GraphQLAPIEndpointOutput attribute for api/productcatalog resource"
    },
    "authproductcatalog6e145452IdentityPoolId": {
      "Type": "String",
      "Description": "Input parameter describing IdentityPoolId attribute for auth/productcatalog6e145452 resource"
    },
    "authproductcatalog6e145452IdentityPoolName": {
      "Type": "String",
      "Description": "Input parameter describing IdentityPoolName attribute for auth/productcatalog6e145452 resource"
    },
    "authproductcatalog6e145452UserPoolId": {
      "Type": "String",
      "Description": "Input parameter describing UserPoolId attribute for auth/productcatalog6e145452 resource"
    },
    "authproductcatalog6e145452UserPoolArn": {
      "Type": "String",
      "Description": "Input parameter describing UserPoolArn attribute for auth/productcatalog6e145452 resource"
    },
    "authproductcatalog6e145452UserPoolName": {
      "Type": "String",
      "Description": "Input parameter describing UserPoolName attribute for auth/productcatalog6e145452 resource"
    },
    "authproductcatalog6e145452AppClientIDWeb": {
      "Type": "String",
      "Description": "Input parameter describing AppClientIDWeb attribute for auth/productcatalog6e145452 resource"
    },
    "authproductcatalog6e145452AppClientID": {
      "Type": "String",
      "Description": "Input parameter describing AppClientID attribute for auth/productcatalog6e145452 resource"
    },
    "customcustomProdInventoryInventoryAlertTopicArn": {
      "Type": "String",
      "Description": "Input parameter describing InventoryAlertTopicArn attribute for custom/customProdInventory resource"
    },
    "customcustomProdInventoryInventoryCheckerFunctionName": {
      "Type": "String",
      "Description": "Input parameter describing InventoryCheckerFunctionName attribute for custom/customProdInventory resource"
    },
    "customcustomProdInventoryUserPoolIdRef": {
      "Type": "String",
      "Description": "Input parameter describing UserPoolIdRef attribute for custom/customProdInventory resource"
    },
    "customcustomProdInventoryGraphQLApiIdRef": {
      "Type": "String",
      "Description": "Input parameter describing GraphQLApiIdRef attribute for custom/customProdInventory resource"
    },
    "customcustomProdInventoryStorageBucketRef": {
      "Type": "String",
      "Description": "Input parameter describing StorageBucketRef attribute for custom/customProdInventory resource"
    },
    "customcustomProdInventoryLowStockFunctionRef": {
      "Type": "String",
      "Description": "Input parameter describing LowStockFunctionRef attribute for custom/customProdInventory resource"
    },
    "functionlowstockproductcatalogName": {
      "Type": "String",
      "Description": "Input parameter describing Name attribute for function/lowstockproductcatalog resource"
    },
    "functionlowstockproductcatalogArn": {
      "Type": "String",
      "Description": "Input parameter describing Arn attribute for function/lowstockproductcatalog resource"
    },
    "functionlowstockproductcatalogRegion": {
      "Type": "String",
      "Description": "Input parameter describing Region attribute for function/lowstockproductcatalog resource"
    },
    "functionlowstockproductcatalogLambdaExecutionRole": {
      "Type": "String",
      "Description": "Input parameter describing LambdaExecutionRole attribute for function/lowstockproductcatalog resource"
    },
    "functionlowstockproductcatalogLambdaExecutionRoleArn": {
      "Type": "String",
      "Description": "Input parameter describing LambdaExecutionRoleArn attribute for function/lowstockproductcatalog resource"
    },
    "storageproductimages3BucketName": {
      "Type": "String",
      "Description": "Input parameter describing BucketName attribute for storage/productimages3 resource"
    },
    "storageproductimages3Region": {
      "Type": "String",
      "Description": "Input parameter describing Region attribute for storage/productimages3 resource"
    }
  },
  "Resources": {
    "ProductQueue": {
      "Type": "AWS::SQS::Queue",
      "Properties": {
        "QueueName": {
          "Fn::Sub": "product-catalog-queue-${env}"
        },
        "VisibilityTimeout": 300
      }
    },
    "ProductTable": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "TableName": {
          "Fn::Sub": "product-catalog-table-${env}"
        },
        "AttributeDefinitions": [
          {
            "AttributeName": "id",
            "AttributeType": "S"
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "id",
            "KeyType": "HASH"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST"
      }
    },
    "LowStockAlertTopic": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "TopicName": {
          "Fn::Sub": "product-catalog-low-stock-${env}"
        },
        "DisplayName": "Product Catalog Low Stock Alerts"
      },
      "DependsOn": [
        "ProductQueue",
        "ProductTable"
      ]
    },
    "InventoryCheckRule": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "Name": {
          "Fn::Sub": "inventory-check-${env}"
        },
        "Description": "Trigger inventory check daily",
        "ScheduleExpression": "rate(24 hours)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Ref": "functionlowstockproductcatalogArn"
            },
            "Id": "LowStockTarget"
          }
        ]
      }
    },
    "LambdaInvokePermission": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Ref": "functionlowstockproductcatalogName"
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "InventoryCheckRule",
            "Arn"
          ]
        }
      },
      "DependsOn": [
        "LowStockAlertTopic"
      ]
    }
  },
  "Outputs": {
    "ProductQueueUrl": {
      "Value": {
        "Ref": "ProductQueue"
      },
      "Description": "URL of the Product Queue"
    },
    "ProductTableName": {
      "Value": {
        "Ref": "ProductTable"
      },
      "Description": "Name of the Product DynamoDB Table"
    },
    "LowStockTopicArn": {
      "Value": {
        "Ref": "LowStockAlertTopic"
      },
      "Description": "ARN of the Low Stock Alert SNS Topic"
    },
    "InventoryCheckRuleArn": {
      "Value": {
        "Fn::GetAtt": [
          "InventoryCheckRule",
          "Arn"
        ]
      },
      "Description": "ARN of the Inventory Check EventBridge Rule"
    }
  },
  "Description": "{\"createdOn\":\"Mac\",\"createdBy\":\"Amplify\",\"createdWith\":\"12.15.0-next-3.0\",\"stackType\":\"custom-customCloudformation\",\"metadata\":{\"whyContinueWithGen1\":\"\"}}"
}
```
```
amplify push
```

## Architecture

**Technology Stack**

- Frontend: React 19 + TypeScript + Vite
- Backend: AWS Amplify with GraphQL API
- Database: AWS DynamoDB (via Amplify)
- Storage: AWS S3 (for product images)
- Authentication: AWS Cognito

**Backend Features**

-> Core Data Models:
- Products - Complete product catalog with:
- Serial numbers, names, prices, categories
- Stock levels, brands, descriptions
- Image storage with S3 integration

-> Users - Multi-role user management:
- ADMIN: Full system access, user management
- MANAGER: Product creation/editing capabilities
- VIEWER: Read-only access

-> AWS Services Integration
- GraphQL API with AWS AppSync for real-time data
- S3 Storage for product image uploads
- Cognito Authentication with role-based access control
- Lambda Functions for business logic (low stock monitoring)

**User Experience**

-> Authentication Flow:
- Sign-up/Sign-in via AWS Cognito
- Automatic Role Assignment: First user becomes Admin, others start as Viewers
- Role-based Interface: UI adapts based on user permissions

**Daily Workflow**

-> For Admins:
- Full dashboard access with all management tools
- Create/edit/delete products with rich form interface
- Manage user roles and permissions
- Download inventory reports
- Monitor low stock alerts

-> For Managers:
- Product creation and editing capabilities
- Access to inventory reports
- Comment on products
- View all products with search/filter

-> For Viewers:
- Browse product catalog
- Search and filter products
- Add comments to products
- View product details and images


## Summary of changes required during Gen1 to Gen2 migration:

Post `amplify gen2-migration generate` :  

1. In `amplify/data/resource.ts`
   
before: `branchName: "main",`  
after: `branchName: "gen2-main",`

2. In `src/main.tsx`
   
before: `import amplifyconfig from '../amplifyconfiguration.json';`  
after: `import amplifyconfig from '../amplify_outputs.json';`

3. In `amplify/function/lowstockproductcatalog/handler.ts`

before: `const LOW_STOCK_THRESHOLD = parseInt(process.env.LOW_STOCK_THRESHOLD) || 5;`  
after: `const LOW_STOCK_THRESHOLD = parseInt(process.env.LOW_STOCK_THRESHOLD ?? '5');`

before: `exports.handler = async (event) => {`  
after: `export const handler = async (event: any) => {`

before: `const products = await fetchProducts();`  
after: `const products = await fetchProducts() as any[];`

before: `} catch (error) {`  
after: `} catch (error: any) {`

before: `const url = new URL(GRAPHQL_ENDPOINT);`  
after: `const url = new URL(GRAPHQL_ENDPOINT ?? '');`

before: `const req = https.request(options, (res) => {`  
after: `const req = https.request(options, (res: any) => {`

before: `res.on('data', (chunk) => {`  
after: `res.on('data', (chunk: any) => {`

before: `req.on('error', (error) => {`  
after: `req.on('error', (error: any) => {`

4. In `amplify/data/resource.ts`:  

before: `authorizationModes: {   
    defaultAuthorizationMode: "iam"   
}`  
after: `authorizationModes: {   
    defaultAuthorizationMode: "iam",   
    apiKeyAuthorizationMode: { expiresInDays: 7 }   
}`   

5. In `amplify/backend.ts`:

add after defineBackend():   
```typescript

const cfnGraphQLApi = backend.data.resources.cfnResources.cfnGraphqlApi;
cfnGraphQLApi.additionalAuthenticationProviders = [
  {
    authenticationType: 'AMAZON_COGNITO_USER_POOLS',
    userPoolConfig: {
      userPoolId: backend.auth.resources.userPool.userPoolId,
      awsRegion: backend.auth.resources.userPool.stack.region
    }
  }
];
```

6. In `amplify/data/resource.ts` (schema section)
    
before: `@function(name: "lowstockproductcatalog-\${env}")`  
after: `@function(name: "lowstockproductcatalog-gen2-main")`











