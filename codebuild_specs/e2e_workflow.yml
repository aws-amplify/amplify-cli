version: 0.2
env:
  shell: bash
  compute-type: BUILD_GENERAL1_MEDIUM
  variables:
    AWS_DEFAULT_REGION: us-east-1
    AWS_REGION: us-east-1
    CDK_DEFAULT_REGION: us-east-1
    CLI_REGION: us-east-1
    TEST_SUITE: src/__tests__/auth_2b.test.ts
    AMPLIFY_DIR: '$CODEBUILD_SRC_DIR/out'
    AMPLIFY_PATH: '$CODEBUILD_SRC_DIR/out/amplify-pkg-linux-x64'

batch:
  fast-fail: false
  build-graph:
    - identifier: build_linux
      buildspec: codebuild_specs/build_linux.yml
      env:
        compute-type: BUILD_GENERAL1_LARGE
    - identifier: test
      buildspec: codebuild_specs/test.yml
      env:
        compute-type: BUILD_GENERAL1_LARGE
      debug-session: true
      depend-on:
        - build_linux
